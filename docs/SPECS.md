# MVP Auto-Summary: Architecture & Specifications

> **Version:** 1.0 | **Date:** 2026-02-18  
> **Status:** Phase 0 ‚Äî MVP  
> **Strategy:** Buy over Build ‚Äî no custom backend

---

## 1. Overview

System for automatic meeting transcription and summarization at a fulfillment company.

**What it does (Phase 0):**
1. Manager conducts a call in Jitsi (room name: `LEAD-{ID}-conf`)
2. Jibri records the meeting ‚Üí file lands on NFS server
3. n8n detects new file ‚Üí sends audio directly to Whisper (self-hosted)
4. Whisper returns transcript ‚Üí saved to open-notebook + metadata in PostgreSQL
5. Daily at 23:00: n8n collects all transcripts ‚Üí GLM-4 summarizes ‚Üí Telegram digest

---

## 2. Architecture Diagram

```
                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                    ‚îÇ                VPS (Ubuntu 22.04)                ‚îÇ
                    ‚îÇ                2 vCPU / 8 GB RAM                 ‚îÇ
                    ‚îÇ                                                  ‚îÇ
                    ‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
                    ‚îÇ  ‚îÇ            docker-compose                   ‚îÇ ‚îÇ
                    ‚îÇ  ‚îÇ                                             ‚îÇ ‚îÇ
                    ‚îÇ  ‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê           ‚îÇ ‚îÇ
                    ‚îÇ  ‚îÇ  ‚îÇ   n8n    ‚îÇ  ‚îÇ open-notebook ‚îÇ           ‚îÇ ‚îÇ
                    ‚îÇ  ‚îÇ  ‚îÇ  :5678   ‚îÇ  ‚îÇ    :8888      ‚îÇ           ‚îÇ ‚îÇ
                    ‚îÇ  ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò           ‚îÇ ‚îÇ
                    ‚îÇ  ‚îÇ       ‚îÇ               ‚îÇ                    ‚îÇ ‚îÇ
                    ‚îÇ  ‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îê              ‚îÇ ‚îÇ
                    ‚îÇ  ‚îÇ  ‚îÇ      PostgreSQL          ‚îÇ              ‚îÇ ‚îÇ
                    ‚îÇ  ‚îÇ  ‚îÇ       :5432              ‚îÇ              ‚îÇ ‚îÇ
                    ‚îÇ  ‚îÇ  ‚îÇ  (n8n metadata store)    ‚îÇ              ‚îÇ ‚îÇ
                    ‚îÇ  ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò              ‚îÇ ‚îÇ
                    ‚îÇ  ‚îÇ                                             ‚îÇ ‚îÇ
                    ‚îÇ  ‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê              ‚îÇ ‚îÇ
                    ‚îÇ  ‚îÇ  ‚îÇ      SurrealDB           ‚îÇ              ‚îÇ ‚îÇ
                    ‚îÇ  ‚îÇ  ‚îÇ       :8000              ‚îÇ              ‚îÇ ‚îÇ
                    ‚îÇ  ‚îÇ  ‚îÇ  (open-notebook data)    ‚îÇ              ‚îÇ ‚îÇ
                    ‚îÇ  ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò              ‚îÇ ‚îÇ
                    ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
                    ‚îÇ                                                  ‚îÇ
                    ‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                              ‚îÇ
                    ‚îÇ  ‚îÇ /mnt/recordings‚îÇ ‚Üê NFS mount (read-only)     ‚îÇ
                    ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                              ‚îÇ
                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                              ‚îÇ                    ‚îÇ
                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                    ‚îÇ  Whisper (local)  ‚îÇ  ‚îÇ  ZhipuAI (GLM)  ‚îÇ
                    ‚îÇ  - STT API        ‚îÇ  ‚îÇ  - GLM-4-FlashX ‚îÇ
                    ‚îÇ  - Container      ‚îÇ  ‚îÇ  :5678 HTTP     ‚îÇ
                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                              ‚îÇ
                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                    ‚îÇ  Telegram Bot API  ‚îÇ
                    ‚îÇ  - Daily digest    ‚îÇ
                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## 3. Key Architectural Decisions

### 3.1. open-notebook = YES (with caveats)

**Verdict: –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è MVP.**

–ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –ø–æ–∫–∞–∑–∞–ª–æ, —á—Ç–æ open-notebook (lfnovo/open-notebook) –∏–º–µ–µ—Ç **–ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π REST API**:

| –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å | –ü–æ–¥–¥–µ—Ä–∂–∫–∞ | Endpoint |
|-------------|-----------|----------|
| –°–æ–∑–¥–∞–Ω–∏–µ –±–ª–æ–∫–Ω–æ—Ç–æ–≤ | YES | `POST /notebooks` |
| –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ (—Ç–µ–∫—Å—Ç, —Ñ–∞–π–ª, URL) | YES | `POST /sources` |
| –ü—Ä–∏–≤—è–∑–∫–∞ –∫ –Ω–µ—Å–∫–æ–ª—å–∫–∏–º –±–ª–æ–∫–Ω–æ—Ç–∞–º | YES | `POST /notebooks/{id}/sources/{id}` |
| RAG-—á–∞—Ç –ø–æ –±–ª–æ–∫–Ω–æ—Ç—É | YES | `POST /chat/execute` |
| –í–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫ | YES | `POST /search` |
| Auto-RAG (–ø–æ–∏—Å–∫ + —Å–∏–Ω—Ç–µ–∑) | YES | `POST /search/ask` |

**LLM-–±—ç–∫–µ–Ω–¥—ã**: 16+ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤. GLM-4 —á–µ—Ä–µ–∑ Ollama (–ª–æ–∫–∞–ª—å–Ω–æ) –∏–ª–∏ OpenRouter (–æ–±–ª–∞–∫–æ).

**–ë–î**: SurrealDB (–≥—Ä–∞—Ñ + –≤–µ–∫—Ç–æ—Ä + –ø–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç).

**–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:**
- –ù–µ—Ç —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø–æ –¥–∞—Ç–µ –≤ API ‚Üí —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –≤ n8n
- –ù–µ—Ç bulk-–æ–ø–µ—Ä–∞—Ü–∏–π ‚Üí –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–µ –≤—ã–∑–æ–≤—ã
- –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —Ç–æ–ª—å–∫–æ –ø–æ –ø–∞—Ä–æ–ª—é ‚Üí –Ω—É–∂–µ–Ω reverse proxy –¥–ª—è prod
- –ö–æ–Ω—Ç–µ–∫—Å—Ç –¥–ª—è —á–∞—Ç–∞ —Å—Ç—Ä–æ–∏—Ç—Å—è –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ ‚Üí –≤ n8n —Å—Ç—Ä–æ–∏—Ç—å –≤—Ä—É—á–Ω—É—é

### 3.2. File Watcher: Cron Scan –≤–º–µ—Å—Ç–æ LocalFileTrigger

**–ü—Ä–æ–±–ª–µ–º–∞**: `LocalFileTrigger` –æ—Ç–∫–ª—é—á—ë–Ω –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤ n8n 2.0. –î–∞–∂–µ –µ—Å–ª–∏ –≤–∫–ª—é—á–∏—Ç—å ‚Äî `inotify` –ù–ï —Ä–∞–±–æ—Ç–∞–µ—Ç —Å NFS (—Ñ–∞–π–ª—ã, —Å–æ–∑–¥–∞–Ω–Ω—ã–µ —É–¥–∞–ª—ë–Ω–Ω–æ–π –º–∞—à–∏–Ω–æ–π, –Ω–µ –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç —Å–æ–±—ã—Ç–∏—è).

**–†–µ—à–µ–Ω–∏–µ**: Schedule Trigger (–∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç) + —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞–ø–∫–∏ + –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ –≤ PostgreSQL.

```
[Schedule: */5 * * * *]
    ‚Üí Read /mnt/recordings/**/*.{webm,mp3}
    ‚Üí Filter: NOT IN processed_files (PostgreSQL)
    ‚Üí For each new file:
        ‚Üí Convert WebM ‚Üí MP3 (ffmpeg)
        ‚Üí Upload to Yandex S3
        ‚Üí Start SpeechKit async
        ‚Üí Mark as "processing" in DB
```

### 3.3. Whisper –≤–º–µ—Å—Ç–æ Yandex SpeechKit (–ò–ó–ú–ï–ù–ï–ù–ò–ï v1.1)

**–†–µ—à–µ–Ω–∏–µ**: –ó–∞–º–µ–Ω–∏–ª–∏ Yandex SpeechKit (25K —Ä—É–±/–º–µ—Å) –Ω–∞ self-hosted Whisper (0 —Ä—É–±/–º–µ—Å).

**–ü–æ—á–µ–º—É Whisper –ª—É—á—à–µ –¥–ª—è —ç—Ç–æ–≥–æ MVP:**

| –ö—Ä–∏—Ç–µ—Ä–∏–π | Yandex SpeechKit | Whisper (self-hosted) |
|----------|------------------|----------------------|
| –°—Ç–æ–∏–º–æ—Å—Ç—å | ~25,000 —Ä—É–±/–º–µ—Å | **0 —Ä—É–±** |
| –§–æ—Ä–º–∞—Ç WebM | ‚ùå –ù–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç | ‚úÖ –ù–∞—Ç–∏–≤–Ω–æ |
| –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è | –ù—É–∂–Ω–∞ (WebM‚ÜíMP3) | **–ù–µ –Ω—É–∂–Ω–∞** |
| S3 upload | –û–±—è–∑–∞—Ç–µ–ª–µ–Ω | **–ù–µ –Ω—É–∂–µ–Ω** |
| Polling | –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π (—Å–ª–æ–∂–Ω–æ) | **–°–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π (–ø—Ä–æ—Å—Ç–æ)** |
| –ü—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç—å | –î–∞–Ω–Ω—ã–µ —É—Ö–æ–¥—è—Ç –≤ –æ–±–ª–∞–∫–æ | **–í—Å—ë –ª–æ–∫–∞–ª—å–Ω–æ** |
| –ö–∞—á–µ—Å—Ç–≤–æ RU | –û—Ç–ª–∏—á–Ω–æ–µ | –û—á–µ–Ω—å —Ö–æ—Ä–æ—à–µ–µ (medium) |
| –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ | API key + S3 + folder_id | **–ù–∏—á–µ–≥–æ** |

**Docker**: `onerahmet/openai-whisper-asr-webservice:latest-cpu`  
**Engine**: faster-whisper (CTranslate2 ‚Äî –≤ 4x –±—ã—Å—Ç—Ä–µ–µ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–≥–æ Whisper)  
**API**: `POST http://whisper:9000/asr?task=transcribe&language=ru&output=json`

**–ú–æ–¥–µ–ª–∏ –∏ —Ä–µ—Å—É—Ä—Å—ã:**

| –ú–æ–¥–µ–ª—å | RAM | –°–∫–æ—Ä–æ—Å—Ç—å (60 –º–∏–Ω) | WER —Ä—É—Å—Å–∫–∏–π |
|--------|-----|-------------------|-------------|
| tiny | +1 GB | ~5 –º–∏–Ω | ~15% |
| base | +1 GB | ~10 –º–∏–Ω | ~10% |
| small | +2 GB | ~20 –º–∏–Ω | ~7% |
| **medium** | **+3 GB** | **~40 –º–∏–Ω** | **~5%** |
| large-v3 | +5 GB | ~90 –º–∏–Ω | ~3% |

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è**: –º–æ–¥–µ–ª—å `medium` ‚Äî –±–∞–ª–∞–Ω—Å –∫–∞—á–µ—Å—Ç–≤–∞ –∏ —Å–∫–æ—Ä–æ—Å—Ç–∏. VPS –Ω—É–∂–µ–Ω 8 GB RAM.

**–ü—Ä–æ—Å—Ç–æ–π flow (–±–µ–∑ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏, –±–µ–∑ S3, –±–µ–∑ polling):**
1. n8n –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç WebM —Ñ–∞–π–ª –Ω–∞–ø—Ä—è–º—É—é –≤ Whisper
2. Whisper –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–µ–∫—Å—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ
3. –ì–æ—Ç–æ–≤–æ

–≠—Ç–æ **—Ä–∞–¥–∏–∫–∞–ª—å–Ω–æ–µ —É–ø—Ä–æ—â–µ–Ω–∏–µ** –ø–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å SpeechKit (—É–±—Ä–∞–Ω—ã 4 —à–∞–≥–∞).

### 3.4. GLM-4: –í—ã–±–æ—Ä –º–æ–¥–µ–ª–∏

| –ú–æ–¥–µ–ª—å | –ö–æ–Ω—Ç–µ–∫—Å—Ç | –¶–µ–Ω–∞ (input/output –∑–∞ 1M tok) | –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è |
|--------|----------|-------------------------------|--------------|
| GLM-4.7-Flash | 200K | **–ë–ï–°–ü–õ–ê–¢–ù–û** | –î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è |
| GLM-4.7-FlashX | 200K | $0.07 / $0.40 | **MVP (production)** |
| GLM-4.7 | 200K | $0.60 / $2.20 | –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ |

**API endpoint**: `https://api.z.ai/api/paas/v4/chat/completions`  
**–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å**: OpenAI-compatible ‚Üí –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å OpenAI-–Ω–æ–¥—É n8n.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è**: GLM-4.7-FlashX –¥–ª—è MVP (~$0.005 –∑–∞ —Å—É–º–º–∞—Ä–∏ –æ–¥–Ω–æ–≥–æ –º–∏—Ç–∏–Ω–≥–∞).

### 3.5. –ù–µ—Ç –∫–∞—Å—Ç–æ–º–Ω–æ–≥–æ –±—ç–∫–µ–Ω–¥–∞

MVP —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –µ–¥–∏–Ω–æ–π —Å—Ç—Ä–æ—á–∫–∏ —Å–µ—Ä–≤–µ—Ä–Ω–æ–≥–æ –∫–æ–¥–∞:
- **n8n** = –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è (workflows)
- **open-notebook** = —Ö—Ä–∞–Ω–µ–Ω–∏–µ + RAG + UI
- **PostgreSQL** = –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ n8n + —Ç—Ä–µ–∫–∏–Ω–≥ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
- **ffmpeg** = –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è (–≤—ã–∑–æ–≤ —á–µ—Ä–µ–∑ n8n Execute Command)

–ï–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π "–∫–æ–¥" ‚Äî JavaScript-—Å–Ω–∏–ø–ø–µ—Ç—ã –≤–Ω—É—Ç—Ä–∏ n8n Code nodes.

---

## 4. Component Responsibilities

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –†–æ–ª—å | –ü–æ—Ä—Ç | –î–∞–Ω–Ω—ã–µ |
|-----------|------|------|--------|
| **n8n** | –û—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è –≤—Å–µ—Ö workflow | 5678 | –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –≤ PostgreSQL |
| **open-notebook** | –•—Ä–∞–Ω–µ–Ω–∏–µ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç–æ–≤, RAG, UI –¥–ª—è –∫—É—Ä–∞—Ç–æ—Ä–æ–≤ | 8888 | SurrealDB |
| **PostgreSQL** | n8n persistence + processed files tracker | 5432 | Volumes |
| **SurrealDB** | –ë–î open-notebook (–≥—Ä–∞—Ñ + –≤–µ–∫—Ç–æ—Ä) | 8000 | Volumes |
| **Whisper (self-hosted)** | STT (Speech-to-Text) | 9000 | Local |
| **GLM-4 (ZhipuAI)** | –°—É–º–º–∞—Ä–∏–∑–∞—Ü–∏—è —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç–æ–≤ | External API | ‚Äî |
| **Telegram Bot** | –û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–π–¥–∂–µ—Å—Ç–æ–≤ | External API | ‚Äî |

---

## 5. Data Flow

### Workflow 1: New Recording ‚Üí Transcription (–∫–∞–∂–¥—ã–µ 5 –º–∏–Ω)

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Schedule Trigger  ‚îÇ ‚Üê –ö–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç
‚îÇ   */5 * * * *     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Scan /recordings  ‚îÇ ‚Üê find + sort by mtime (–Ω–æ–≤—ã–µ –ø–µ—Ä–≤—ã–µ)
‚îÇ *.webm, *.mp3     ‚îÇ   –º–∞–∫—Å–∏–º—É–º 50 —Ñ–∞–π–ª–æ–≤ –∑–∞ —Ä–∞–∑
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Parse LEAD_ID              ‚îÇ ‚Üê Regex: /^(\d+)_/
‚îÇ from filename              ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Check PostgreSQL           ‚îÇ ‚Üê COUNT(*) processed_files
‚îÇ Is New File?               ‚îÇ   count=0 ‚Üí –Ω–æ–≤—ã–π
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ (—Ç–æ–ª—å–∫–æ –Ω–æ–≤—ã–µ)
         ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Mark as Transcribing       ‚îÇ ‚Üê INSERT status='transcribing'
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Read Binary File           ‚îÇ ‚Üê –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞ –≤ –ø–∞–º—è—Ç—å
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Whisper Transcribe         ‚îÇ ‚Üê POST /asr (multipart)
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ Has     ‚îÇ
    ‚îÇTranscript‚îÇ
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îò
    yes  ‚îÇ  no
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ         ‚îÇ
    ‚ñº         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇExtract‚îÇ ‚îÇ Error ‚îÇ
‚îÇ Text  ‚îÇ ‚îÇ Mark  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
    ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Get/Create Notebook       ‚îÇ ‚Üê open-notebook API
‚îÇ Save Transcript           ‚îÇ   —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ Save    ‚îÇ
    ‚îÇ Success?‚îÇ
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îò
    yes  ‚îÇ  no
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ         ‚îÇ
    ‚ñº         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Mark  ‚îÇ ‚îÇ Error ‚îÇ
‚îÇ Compl ‚îÇ ‚îÇ Mark  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

*Workflow 1.5 (polling SpeechKit) –£–î–ê–õ–Å–ù ‚Äî —Å Whisper —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è, polling –Ω–µ –Ω—É–∂–µ–Ω.*

### Workflow 2: Daily Digest (23:00)

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Schedule Trigger  ‚îÇ ‚Üê –ö–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 23:00
‚îÇ   0 23 * * *      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ SELECT v_today_completed   ‚îÇ ‚Üê summary_sent=false
‚îÇ from PostgreSQL            ‚îÇ    AND status = 'completed'
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Aggregate transcripts      ‚îÇ ‚Üê Code node
‚îÇ (max 50K chars, truncate)  ‚îÇ   –∑–∞—â–∏—Ç–∞ –æ—Ç –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏—è
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ GLM-4.7-FlashX summarize   ‚îÇ ‚Üê POST /chat/completions
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Send Telegram digest       ‚îÇ ‚Üê POST /sendMessage
‚îÇ (chunks max 3500 chars)    ‚îÇ   —Ä–∞–∑–±–∏–µ–Ω–∏–µ –Ω–∞ —á–∞—Å—Ç–∏
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Update processed_files     ‚îÇ ‚Üê summary_sent=true
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## 6. Risk Analysis

### RED (Critical)

| Risk | Impact | Mitigation |
|------|--------|------------|
| **Whisper OOM / model too heavy** | Pipeline stops | Use smaller model (small/medium) or upgrade RAM |
| **NFS mount drops** | No new recordings detected | Health check workflow; alert to Telegram |
| **Whisper timeout on long files** | Transcriptions queue up | Increase HTTP timeout; split long files |
| **open-notebook API changes** | Integration breaks | Pin Docker image version; test before upgrade |

### YELLOW (Medium)

| Risk | Impact | Mitigation |
|------|--------|------------|
| Whisper processing backlog (slow CPU) | Digest delay | Use smaller model; schedule off-peak; scale VPS |
| GLM-4 API instability (China-hosted) | Digest delay | Retry logic; fallback to GLM-4.7-Flash (free) |
| open-notebook SurrealDB data loss | Loss of transcripts | Daily DB backup script; keep original files |
| Duplicate processing | Double transcription costs | Idempotency via PostgreSQL processed_files table |

### GREEN (Low)

| Risk | Impact | Mitigation |
|------|--------|------------|
| Manager forgets LEAD-{ID} naming | File not processed | Alert on "unknown" files; manual reprocessing |
| Telegram bot rate limit | Digest delayed | Single message per day is well under limit |

---

## 7. Migration Path (Phase 0 ‚Üí Full Vision)

**Phase 0 does NOT paint into a corner** because:

1. **open-notebook supports RAG** ‚Üí Phase 4 (RAG-—á–∞—Ç –ø–æ –∫–ª–∏–µ–Ω—Ç—É) available immediately
2. **PostgreSQL already present** ‚Üí Phase 1 (Telegram history) can store data here
3. **n8n is extensible** ‚Üí Phase 2 (Bitrix24) = new workflow + HTTP nodes
4. **LEAD-{ID} is the universal key** ‚Üí all phases use the same client identifier
5. **open-notebook multi-notebook** ‚Üí each client = 1 notebook, all sources linked

### Phase Roadmap

| Phase | Scope | New Components | Effort |
|-------|-------|----------------|--------|
| **0** (current) | Meetings ‚Üí Transcription ‚Üí Digest | n8n, open-notebook, Whisper, GLM-4, Telegram | 1-2 weeks |
| **1** | Telegram chat history import | Telegram Bot (webhook) + n8n | 1 week |
| **2** | Bitrix24 call/email summaries | n8n HTTP ‚Üí Bitrix API | 1 week |
| **3** | Unified client profile | open-notebook notebooks as profiles | 1 week |
| **4** | RAG chat per client | open-notebook /chat/execute | Already built-in |
| **5** | WMS integration + alerts | n8n HTTP ‚Üí WMS API, alert workflow | 2 weeks |
| **6** | Churn risk detection | GLM-4 analysis workflow, scoring | 2 weeks |

---

## 8. Project Structure

```
mvp-auto-summary/
‚îú‚îÄ‚îÄ docker-compose.yml          # Infrastructure: n8n + open-notebook + DBs
‚îú‚îÄ‚îÄ .env.example                # Environment variables template
‚îú‚îÄ‚îÄ .gitignore                  # Exclude .env, volumes, temp files
‚îÇ
‚îú‚îÄ‚îÄ docs/
‚îÇ   ‚îú‚îÄ‚îÄ SPECS.md                # This file ‚Äî architecture & decisions
‚îÇ   ‚îú‚îÄ‚îÄ API.md                  # API contracts (external services)
‚îÇ   ‚îî‚îÄ‚îÄ ERRORS.md               # Known errors & troubleshooting
‚îÇ
‚îú‚îÄ‚îÄ n8n-workflows/
‚îÇ   ‚îú‚îÄ‚îÄ 01-new-recording.json       # Workflow 1: Scan ‚Üí Whisper ‚Üí open-notebook
‚îÇ   ‚îî‚îÄ‚îÄ 02-daily-digest.json        # Workflow 2: Summarize ‚Üí Telegram
‚îÇ
‚îú‚îÄ‚îÄ scripts/
‚îÇ   ‚îú‚îÄ‚îÄ convert-audio.sh        # ffmpeg WebM ‚Üí MP3 conversion
‚îÇ   ‚îú‚îÄ‚îÄ test-connections.sh     # Verify all APIs are reachable
‚îÇ   ‚îú‚îÄ‚îÄ backup-db.sh            # Daily database backup
‚îÇ   ‚îî‚îÄ‚îÄ simulate-recording.sh   # Drop test file for workflow testing
‚îÇ
‚îú‚îÄ‚îÄ MVP_PHASE0_TZ.md            # Original requirements doc
‚îî‚îÄ‚îÄ –æ—Ç_—Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–∞.txt           # Original management instructions
```

---

## 9. Cost Estimate (Monthly) ‚Äî UPDATED v1.1

| Component | Cost | Notes |
|-----------|------|-------|
| VPS (2 vCPU, 8 GB RAM) | ~2,500 RUB | Ubuntu 22.04 |
| Whisper (self-hosted) | **0 RUB** | –ë–µ—Å–ø–ª–∞—Ç–Ω–æ, —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ VPS |
| GLM-4.7-FlashX API | ~300 RUB | ~$0.005 per summary |
| **TOTAL** | **~2,800 RUB/month** | |

> **–≠–∫–æ–Ω–æ–º–∏—è 90%** –ø–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å –ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω—ã–º –ø–ª–∞–Ω–æ–º (27,500 ‚Üí 2,800 —Ä—É–±).

---

## 10. Changes to Original TZ

### Added (not in original TZ)

1. **Self-hosted Whisper** ‚Äî –∑–∞–º–µ–Ω—è–µ—Ç Yandex SpeechKit, —ç–∫–æ–Ω–æ–º–∏—Ç 25K —Ä—É–±/–º–µ—Å
2. **PostgreSQL tracker** ‚Äî Idempotency: track processed files to avoid double transcription
3. **Cron scan instead of file watcher** ‚Äî NFS + inotify = broken; polling is reliable

### Changed (v1.1 ‚Äî Whisper update)

1. **STT engine**: Yandex SpeechKit ‚Üí **self-hosted Whisper** (–±–µ—Å–ø–ª–∞—Ç–Ω–æ, WebM –Ω–∞—Ç–∏–≤–Ω–æ)
2. **–£–±—Ä–∞–Ω—ã**: Yandex Object Storage, format conversion, async polling workflow
3. **open-notebook port**: 3000 ‚Üí **8888** (actual default port)
4. **GLM-4 endpoint**: `open.bigmodel.cn` ‚Üí **`api.z.ai`** (current endpoint)
5. **GLM-4 model**: `glm-4-flash` ‚Üí **`glm-4.7-flashx`** (better value, 200K context)
6. **File trigger**: `LocalFileTrigger` ‚Üí **Schedule Trigger + folder scan** (reliability)
7. **–°—Ç–æ–∏–º–æ—Å—Ç—å**: 27,500 ‚Üí **2,800 —Ä—É–±/–º–µ—Å**

### Open Questions Resolved

1. **open-notebook API**: YES, has full REST API
2. **GLM-4 via n8n**: YES, OpenAI-compatible
3. **Whisper vs SpeechKit**: Whisper –ø–æ–±–µ–∂–¥–∞–µ—Ç –ø–æ –≤—Å–µ–º –∫—Ä–∏—Ç–µ—Ä–∏—è–º –¥–ª—è —ç—Ç–æ–≥–æ MVP
4. **Yandex Cloud**: –ù–ï –ù–£–ñ–ï–ù ‚Äî Whisper –∑–∞–º–µ–Ω—è–µ—Ç SpeechKit

### Still Open (–ù–£–ñ–ï–ù –û–¢–í–ï–¢ –û–¢ –¢–ï–ë–Ø)

1. **NFS server IP and path** ‚Äî –∂–¥—ë–º –æ—Ç —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—è (–Ω–∞—Å—Ç—Ä–æ–∏—Ç Jibri)
2. **Telegram chat ID** ‚Äî –∫–∞–∫–æ–π –≥—Ä—É–ø–ø–æ–≤–æ–π —á–∞—Ç –¥–ª—è –¥–∞–π–¥–∂–µ—Å—Ç–æ–≤?
3. **LEAD ID format** ‚Äî —Ç–æ–ª—å–∫–æ —Ü–∏—Ñ—Ä—ã? –ò–∑ Bitrix24?

---

## 11. Telegram Chat History ‚Äî –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

### –ü–æ—á–µ–º—É –Ω–µ –±–æ—Ç

Telegram Bot API **–Ω–µ –º–æ–∂–µ—Ç —á–∏—Ç–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—é** ‚Äî –±–æ—Ç –≤–∏–¥–∏—Ç —Ç–æ–ª—å–∫–æ –Ω–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ —á–∞—Ç. –ß—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –ø–µ—Ä–µ–ø–∏—Å–∫—É –∫–æ—Ç–æ—Ä–∞—è —É–∂–µ –±—ã–ª–∞ ‚Äî –Ω—É–∂–µ–Ω **Telethon (User API)**: —Ä–∞–±–æ—Ç–∞–µ—Ç –æ—Ç –∏–º–µ–Ω–∏ –æ–±—ã—á–Ω–æ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞ –∏ —á–∏—Ç–∞–µ—Ç –≤—Å—é –∏—Å—Ç–æ—Ä–∏—é.

### –ò—Ç–æ–≥–æ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (2026-02-20)

```
–û–¥–∏–Ω —Ä–∞–±–æ—á–∏–π Telegram-–∞–∫–∫–∞—É–Ω—Ç
    (–¥–æ–±–∞–≤–ª–µ–Ω –≤–æ –≤—Å–µ –≥—Ä—É–ø–ø–æ–≤—ã–µ —á–∞—Ç—ã —Å –∫–ª–∏–µ–Ω—Ç–∞–º–∏)
            ‚îÇ
            ‚ñº
  python export_telegram_chat.py
  (–∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ, —á–∏—Ç–∞–µ—Ç –∏—Å—Ç–æ—Ä–∏—é —á–µ—Ä–µ–∑ Telethon)
            ‚îÇ
            ‚ñº
  /exports/chats/LEAD-101_chat.json   ‚Üê –ø–æ–ª–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è
            ‚îÇ
            ‚ñº
  python import_chat_to_db.py
            ‚îÇ
            ‚ñº
  PostgreSQL: —Ç–∞–±–ª–∏—Ü–∞ chat_messages
            ‚îÇ
            ‚ñº  (–∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 22:00)
  Workflow 03 (n8n)
  ‚Üí GLM-4 —Å—É–º–º–∞—Ä–∏–∑–∏—Ä—É–µ—Ç –ø–µ—Ä–µ–ø–∏—Å–∫—É –∑–∞ –¥–µ–Ω—å
  ‚Üí –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ client_summaries
            ‚îÇ
            ‚ñº  (–∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 23:00)
  Workflow 02 (n8n)
  ‚Üí –°–æ–±–∏—Ä–∞–µ—Ç –≤—Å–µ summaries
  ‚Üí –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –¥–∞–π–¥–∂–µ—Å—Ç –≤ Telegram-–±–æ—Ç @ffp_report_bot
```

### –ö–∞–∫ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ –º–Ω–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–æ–≤

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–∞–±–ª–∏—Ü–∞ `lead_chat_mapping`: –æ–¥–∏–Ω —Ä–∞–∑ –∑–∞–ø–æ–ª–Ω—è–µ—à—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ "–¥–æ–≥–æ–≤–æ—Ä ‚Üî —á–∞—Ç", –¥–∞–ª—å—à–µ —Å–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±—Ö–æ–¥–∏—Ç –≤—Å–µ –∑–∞–ø–∏—Å–∏.

```sql
-- –ü—Ä–∏–º–µ—Ä –∑–∞–ø–∏—Å–∏:
INSERT INTO lead_chat_mapping (lead_id, lead_name, chat_id, chat_title)
VALUES ('101', '–û–û–û –†–æ–º–∞—à–∫–∞', -1009876543210, '–†–æ–º–∞—à–∫–∞ ‚Äî –ø–æ—Å—Ç–∞–≤–∫–∏');
```

–ö–∞–∫ –ø–æ–ª—É—á–∏—Ç—å chat_id —á–∞—Ç–∞: `python list_telegram_chats.py` ‚Äî –≤—ã–≤–µ–¥–µ—Ç –≤—Å–µ —á–∞—Ç—ã —Å ID.

### –ö–∞–∫–æ–π –∞–∫–∫–∞—É–Ω—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

| –í–∞—Ä–∏–∞–Ω—Ç | –ü–ª—é—Å—ã | –ú–∏–Ω—É—Å—ã |
|---------|-------|--------|
| –õ–∏—á–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç –º–µ–Ω–µ–¥–∂–µ—Ä–∞ | –£–∂–µ –µ—Å—Ç—å –¥–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º —á–∞—Ç–∞–º | –õ–∏—á–Ω–∞—è –ø–µ—Ä–µ–ø–∏—Å–∫–∞ –ø–æ–ø–∞–¥—ë—Ç –≤ —Å–∏—Å—Ç–µ–º—É, —Ä–∏—Å–∫ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ |
| –û–±—â–∏–π —Ä–∞–±–æ—á–∏–π –∞–∫–∫–∞—É–Ω—Ç | –ë–µ–∑–æ–ø–∞—Å–Ω–æ, –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ–º–æ | –ù—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –≤ –≤—Å–µ –≥—Ä—É–ø–ø—ã –≤—Ä—É—á–Ω—É—é |

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è**: –æ–±—â–∏–π —Ä–∞–±–æ—á–∏–π –∞–∫–∫–∞—É–Ω—Ç.

### –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è (–æ–¥–∏–Ω —Ä–∞–∑)

1. `python list_telegram_chats.py` –Ω–∞ –∫–æ–º–ø—å—é—Ç–µ—Ä–µ ‚Üí QR-–≤—Ö–æ–¥ ‚Üí –≤–≤–æ–¥–∏—à—å –ø–∞—Ä–æ–ª—å –¥–≤—É—Ö—Ñ–∞–∫—Ç–æ—Ä–∫–∏
2. –ö–æ–ø–∏—Ä—É–µ—à—å `mvp_session.session` –Ω–∞ —Å–µ—Ä–≤–µ—Ä —á–µ—Ä–µ–∑ WinSCP
3. –ë–æ–ª—å—à–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –Ω–µ –Ω—É–∂–Ω–∞ ‚Äî —Å–µ—Å—Å–∏—è —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ —Ñ–∞–π–ª–µ

–ü–æ–¥—Ä–æ–±–Ω–µ–µ –ø—Ä–æ –ø—Ä–æ–±–ª–µ–º—ã –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏: —Å–º. E047‚ÄìE052 –≤ ERRORS.md

---

---

## 12. –°—Ç–∞—Ç—É—Å —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏—è (2026-02-19, –§–ò–ù–ê–õ–¨–ù–´–ô)

### ‚úÖ MVP –ü–û–õ–ù–û–°–¢–¨–Æ –†–ê–ë–û–¢–ê–ï–¢

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –°—Ç–∞—Ç—É—Å | –ü—Ä–∏–º–µ—á–∞–Ω–∏—è |
|-----------|--------|------------|
| PostgreSQL | ‚úÖ Running | Healthy |
| SurrealDB | ‚úÖ Running | v2, —Ç—Ä–µ–±—É–µ—Ç `chmod 777` –Ω–∞ volume –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ |
| Whisper STT | ‚úÖ Running | –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω, —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∏—Ä—É–µ—Ç —Ä—É—Å—Å–∫–∏–π —è–∑—ã–∫ (–º–æ–¥–µ–ª—å medium) |
| open-notebook | ‚úÖ Running | UI –Ω–∞ :8888, –≤–æ—Ä–∫–µ—Ä —Å—Ç–∞–±–∏–ª–µ–Ω |
| n8n | ‚úÖ Running | UI –Ω–∞ :5678, workflows –∞–∫—Ç–∏–≤–Ω—ã |
| Telegram Bot | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç | `@ffp_report_bot`, –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –¥–∞–π–¥–∂–µ—Å—Ç—ã |
| **Workflow 01** | ‚úÖ –ü–æ–ª–Ω–æ—Å—Ç—å—é —Ä–∞–±–æ—Ç–∞–µ—Ç | –§–∞–π–ª ‚Üí Whisper ‚Üí open-notebook ‚Üí PostgreSQL ‚úÖ |
| **Workflow 02** | ‚úÖ –ü–æ–ª–Ω–æ—Å—Ç—å—é —Ä–∞–±–æ—Ç–∞–µ—Ç | PostgreSQL ‚Üí GLM-4 ‚Üí Telegram ‚úÖ |

### ‚úÖ –ü–æ–ª–Ω—ã–π E2E —Ç–µ—Å—Ç –ø—Ä–æ–π–¥–µ–Ω (2026-02-19)

**Workflow 01 (—Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è):**
```
–¢–µ—Å—Ç: /mnt/recordings/2026/02/18/77777_2026-02-18_17-30.wav
–†–µ–∑—É–ª—å—Ç–∞—Ç:
  ‚úÖ n8n –Ω–∞—à—ë–ª —Ñ–∞–π–ª —á–µ—Ä–µ–∑ List Recording Files
  ‚úÖ Parse Filenames –∏–∑–≤–ª—ë–∫ LEAD_ID
  ‚úÖ Check If Already Processed ‚Äî —Ñ–∞–π–ª –Ω–æ–≤—ã–π
  ‚úÖ Mark as Transcribing ‚Äî –∑–∞–ø–∏—Å—å –≤ PostgreSQL
  ‚úÖ Whisper Transcribe ‚Äî —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∞
  ‚úÖ Save Transcript to Notebook
  ‚úÖ Mark Completed
```

**Workflow 02 (–¥–∞–π–¥–∂–µ—Å—Ç):**
```
–¢–µ—Å—Ç: –¢–µ—Å—Ç–æ–≤—ã–µ –∑–∞–ø–∏—Å–∏ –≤ processed_files (IDs 18, 19, 20)
–†–µ–∑—É–ª—å—Ç–∞—Ç:
  ‚úÖ Load Today's Transcripts ‚Üí –¥–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã
  ‚úÖ Aggregate Transcripts ‚Üí combined text –≥–æ—Ç–æ–≤
  ‚úÖ Has Data? ‚Üí true –≤–µ—Ç–∫–∞
  ‚úÖ GLM-4 Summarize ‚Üí —É—Å–ø–µ—à–Ω—ã–π –æ—Ç–≤–µ—Ç (thinking disabled)
  ‚úÖ Build Digest ‚Üí –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –¥–∞–π–¥–∂–µ—Å—Ç
  ‚úÖ Chunk for Telegram ‚Üí —Ä–∞–∑–±–∏–µ–Ω–∏–µ –Ω–∞ —á–∞—Å—Ç–∏
  ‚úÖ Send Telegram ‚Üí —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–æ—Å—Ç–∞–≤–ª–µ–Ω–æ –≤ @ffp_report_bot
  ‚úÖ Mark Summary Sent ‚Üí summary_sent = true
```

### üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã (—Å–µ—Å—Å–∏–∏ 1-3)

| –ü—Ä–æ–±–ª–µ–º–∞ | –û—à–∏–±–∫–∞ | –†–µ—à–µ–Ω–∏–µ |
|----------|--------|---------|
| GLM-4 API –±–∞–ª–∞–Ω—Å | E041 | –°–º–µ–Ω–∏–ª–∏ –Ω–∞ open.bigmodel.cn + —Ä–∞–±–æ—á–∏–π –∫–ª—é—á |
| Telegram $env –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω | E042 | –•–∞—Ä–¥–∫–æ–¥–∏—Ä–æ–≤–∞–ª–∏ —Ç–æ–∫–µ–Ω –∏ chat_id –≤ –Ω–æ–¥–µ |
| GLM-4 thinking mode | E043 | –î–æ–±–∞–≤–∏–ª–∏ `thinking: {type: "disabled"}` |
| Build Digest –ø—É—Å—Ç–æ–π | E043 | Fallback –Ω–∞ reasoning_content |
| Load Today's Transcripts —Å—Ç–æ–ø | E044 | –°–±—Ä–æ—Å summary_sent = false |
| INSERT –±–µ–∑ filepath | E045 | –î–æ–±–∞–≤–∏–ª–∏ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ filepath |

### üìã –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ (summary)

**–°–µ—Å—Å–∏—è 1:**
- –†–∞–∑–≤–µ—Ä–Ω—É—Ç–∞ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (docker-compose up)
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã E020-E040 (SurrealDB, n8n cookie, env vars)
- Workflow 01 –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç

**–°–µ—Å—Å–∏—è 2:**
- GLM-4 –∫–ª—é—á–∏ –ø–µ—Ä–µ–±—Ä–∞–Ω—ã, –Ω–∞–π–¥–µ–Ω —Ä–∞–±–æ—á–∏–π
- –°–º–µ–Ω—ë–Ω endpoint: api.z.ai ‚Üí open.bigmodel.cn
- Telegram —Ç–æ–∫–µ–Ω –∑–∞—Ö–∞—Ä–¥–∫–æ–∂–µ–Ω –≤ –Ω–æ–¥—É
- –ü–µ—Ä–≤—ã–π —Ç–µ—Å—Ç Workflow 02 ‚Äî —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ Telegram –ø–æ–ª—É—á–µ–Ω–æ

**–°–µ—Å—Å–∏—è 3:**
- –û–±–Ω–∞—Ä—É–∂–µ–Ω–∞ –ø—Ä–æ–±–ª–µ–º–∞ GLM-4 thinking mode (E043)
- –î–æ–±–∞–≤–ª–µ–Ω `thinking: {type: "disabled"}` –≤ –∑–∞–ø—Ä–æ—Å GLM-4
- –î–æ–±–∞–≤–ª–µ–Ω fallback –Ω–∞ reasoning_content –≤ Build Digest
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–±–ª–µ–º–∞ —Å —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ (E044, E045)
- **–§–∏–Ω–∞–ª—å–Ω—ã–π E2E —Ç–µ—Å—Ç ‚Äî –£–°–ü–ï–®–ù–û ‚úÖ**

### üîë –î–æ—Å—Ç—É–ø—ã (—Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ –Ω–∞–¥—ë–∂–Ω–æ–º –º–µ—Å—Ç–µ)

| –°–µ—Ä–≤–∏—Å | URL | –î–∞–Ω–Ω—ã–µ |
|--------|-----|--------|
| n8n UI | `http://84.252.100.93:5678` | `rod@zevich.ru` / `Ill216johan511lol2` |
| open-notebook | `http://84.252.100.93:8888` | –ü–∞—Ä–æ–ª—å –∏–∑ `.env` (`OPEN_NOTEBOOK_TOKEN`) |
| Telegram Bot | `@ffp_report_bot` | Token: `8527521201:AAHpyrPn4cig-zq0Xymt7lZ94qBIEXnYAeQ` |
| Telegram Chat ID | `-1003872092456` | –ì—Ä—É–ø–ø–∞ "–û—Ç—á—ë—Ç—ã –§–§ –ü–ª–∞—Ç—Ñ–æ—Ä–º—ã" |

### üîë GLM-4 API ‚Äî —Ä–∞–±–æ—á–∏–π –∫–ª—é—á

| –ö–ª—é—á | –°—Ç–∞—Ç—É—Å | –≠–Ω–¥–ø–æ–∏–Ω—Ç | –ú–æ–¥–µ–ª—å |
|------|--------|----------|--------|
| `fda5cc088ab04a1a92d5966b373e81a3.rfUescuUieAO78M6` | ‚úÖ –†–∞–±–æ—á–∏–π | `https://open.bigmodel.cn/api/paas/v4/chat/completions` | `glm-4.7-flash` |

### ‚ö†Ô∏è –ü–µ—Ä–µ–¥ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–æ–º

1. **–û—á–∏—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ**: `DELETE FROM processed_files WHERE filename LIKE 'TEST%' OR filename LIKE 'test%';`
2. **–ü–æ–¥–∫–ª—é—á–∏—Ç—å NFS** ‚Äî –∫–æ–≥–¥–∞ —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å –Ω–∞—Å—Ç—Ä–æ–∏—Ç Jibri (–∑–∞–ø–∏—Å–∏ —Ä–µ–∞–ª—å–Ω—ã—Ö —Å–æ–∑–≤–æ–Ω–æ–≤)
3. **–î–æ–±–∞–≤–∏—Ç—å healthcheck –¥–ª—è SurrealDB** (—Å–º. —Å–µ–∫—Ü–∏—é 13)

---

## 13. docker-compose.yml ‚Äî —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ —É–ª—É—á—à–µ–Ω–∏—è –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞

–î–æ–±–∞–≤–∏—Ç—å –≤ `docker-compose.yml` –ø–µ—Ä–µ–¥ –¥–µ–ø–ª–æ–µ–º:

```yaml
# 1. Healthcheck –¥–ª—è SurrealDB (—É—Å—Ç—Ä–∞–Ω—è–µ—Ç race condition —Å open-notebook)
surrealdb:
  healthcheck:
    test: ["CMD-SHELL", "printf 'GET /health HTTP/1.0\r\n\r\n' | nc localhost 8000 | grep -q 'ok' || exit 1"]
    interval: 10s
    timeout: 5s
    retries: 5
    start_period: 15s

# 2. open-notebook depends_on surrealdb healthy
open-notebook:
  depends_on:
    surrealdb:
      condition: service_healthy
```

---

---

## 14. –§–∞–∑–∞ 2: Telegram —á–∞—Ç—ã + –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ summaries (2026-02-20)

### 14.1. –ù–æ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –û–ø–∏—Å–∞–Ω–∏–µ |
|-----------|----------|
| `chat_messages` (PostgreSQL) | –•—Ä–∞–Ω–∏—Ç –∏—Å—Ç–æ—Ä–∏—é Telegram –ø–µ—Ä–µ–ø–∏—Å–∫–∏ –ø–æ –∫–ª–∏–µ–Ω—Ç–∞–º |
| `client_summaries` (PostgreSQL) | –•—Ä–∞–Ω–∏—Ç –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ summaries (—Å–æ–∑–≤–æ–Ω / —á–∞—Ç) |
| `Workflow 03` (n8n) | –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ summaries –∏–∑ –∑–≤–æ–Ω–∫–æ–≤ –∏ —á–∞—Ç–æ–≤ |
| `export_telegram_chat.py` | –í—ã–≥—Ä—É–∑–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏ —á–∞—Ç–∞ —á–µ—Ä–µ–∑ Telethon (–ª–∏—á–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç) |
| `import_chat_to_db.py` | –ò–º–ø–æ—Ä—Ç –≤—ã–≥—Ä—É–∂–µ–Ω–Ω–æ–≥–æ —á–∞—Ç–∞ –≤ PostgreSQL |
| `generate_individual_summary.py` | –ì–µ–Ω–µ—Ä–∞—Ü–∏—è summary –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –ë–î (–∑–≤–æ–Ω–∫–∏ + —á–∞—Ç—ã) |
| `combine_client_data.py` | –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ summaries –∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏—è daily digest |

### 14.2. –ù–æ–≤—ã–µ —Ç–∞–±–ª–∏—Ü—ã PostgreSQL

```sql
-- –¢–∞–±–ª–∏—Ü–∞ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–∏ Telegram —á–∞—Ç–æ–≤
CREATE TABLE chat_messages (
    id SERIAL PRIMARY KEY,
    lead_id VARCHAR(50),
    chat_title VARCHAR(255),
    sender VARCHAR(100),
    message_text TEXT,
    message_date TIMESTAMP,
    imported_at TIMESTAMP DEFAULT NOW(),
    summary_sent BOOLEAN DEFAULT FALSE
);

-- –¢–∞–±–ª–∏—Ü–∞ –¥–ª—è –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã—Ö summaries
CREATE TABLE client_summaries (
    id SERIAL PRIMARY KEY,
    lead_id VARCHAR(50),
    source_type VARCHAR(20),  -- 'call' –∏–ª–∏ 'chat'
    source_id INTEGER,
    summary_text TEXT,
    summary_date DATE,
    created_at TIMESTAMP DEFAULT NOW()
);
```

### 14.3. Workflow 03: –ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ summaries

```
[Schedule 22:00]
    ‚îÇ
    ‚îú‚îÄ‚îÄ Load Today's Calls (processed_files)
    ‚îÇ       ‚Üí Prepare Calls
    ‚îÇ       ‚Üí GLM-4: Summarize Call (–ø—Ä–æ–º–ø—Ç –¥–ª—è —Å–æ–∑–≤–æ–Ω–∞)
    ‚îÇ       ‚Üí Extract Call Summary ‚Üí Save to client_summaries
    ‚îÇ
    ‚îî‚îÄ‚îÄ Load Today's Chats (chat_messages, –∞–≥—Ä–µ–≥–∞—Ü–∏—è –ø–æ lead_id)
            ‚Üí Prepare Chats
            ‚Üí GLM-4: Summarize Chat (–ø—Ä–æ–º–ø—Ç –¥–ª—è —á–∞—Ç–∞)
            ‚Üí Extract Chat Summary ‚Üí Save to client_summaries
```

### 14.4. –ö–∞–∫ –∑–∞–≥—Ä—É–∑–∏—Ç—å Telegram —á–∞—Ç—ã

**–í–∞—Ä–∏–∞–Ω—Ç A (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è): —á–µ—Ä–µ–∑ —Å–∫—Ä–∏–ø—Ç (Telethon)**

```bash
# –®–∞–≥ 1: –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å–ø–∏—Å–æ–∫ —Å–≤–æ–∏—Ö —á–∞—Ç–æ–≤ (–ø–æ–ª—É—á–∏—Ç—å –∏—Ö ID)
cd /root/mvp-auto-summary/scripts
python3 list_telegram_chats.py
# –ü–æ–∫–∞–∂–µ—Ç –≤—Å–µ —á–∞—Ç—ã —Å —á–∏—Å–ª–æ–≤—ã–º–∏ ID –≤–∏–¥–∞ -1009876543210

# –®–∞–≥ 2: –í—ã–≥—Ä—É–∑–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —á–∞—Ç –ø–æ ID
python3 export_telegram_chat.py --chat -1009876543210 --lead-id 101
# –†–µ–∑—É–ª—å—Ç–∞—Ç: exports/chats/LEAD-101_chat.json

# –®–∞–≥ 3: –ó–∞–≥—Ä—É–∑–∏—Ç—å –≤ –±–∞–∑—É
python3 import_chat_to_db.py --lead-id 101 --file ../exports/chats/LEAD-101_chat.json
```

**API credentials (–ø–æ–ª—É—á–µ–Ω—ã 2026-02-20, –≤—à–∏—Ç—ã –≤ —Å–∫—Ä–∏–ø—Ç—ã):**
- api_id: `32782815`
- api_hash: `a4c241e64433835b4a335b62520ab005`

**–¢–∞–±–ª–∏—Ü–∞ –º–∞–ø–ø–∏–Ω–≥–∞** `lead_chat_mapping`: —Å–≤—è–∑—å –¥–æ–≥–æ–≤–æ—Ä ‚Üî Telegram —á–∞—Ç.
–ó–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑ –≤—Ä—É—á–Ω—É—é, –ø–æ—Ç–æ–º –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –µ–∂–µ–¥–Ω–µ–≤–Ω–æ–π –≤—ã–≥—Ä—É–∑–∫–∏ –≤—Å–µ—Ö —á–∞—Ç–æ–≤.

**–í–∞—Ä–∏–∞–Ω—Ç B (—Ä—É—á–Ω–æ–π): copy-paste –∏–∑ Telegram Desktop**

1. –û—Ç–∫—Ä–æ–π —á–∞—Ç ‚Üí —Å–∫–æ–ø–∏—Ä—É–π —Å–æ–æ–±—â–µ–Ω–∏—è –≤ —Ç–µ–∫—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª
2. –°–æ—Ö—Ä–∞–Ω–∏ –∫–∞–∫ `LEAD-101_chat.txt` –≤ —Ñ–æ—Ä–º–∞—Ç–µ `[–î–î.–ú–ú.–ì–ì–ì–ì –ß–ß:–ú–ú] –ò–º—è: —Ç–µ–∫—Å—Ç`
3. –ó–∞–≥—Ä—É–∑–∏ —á–µ—Ä–µ–∑ WinSCP –≤ `/root/mvp-auto-summary/exports/chats/`
4. –ó–∞–ø—É—Å—Ç–∏: `python3 import_chat_to_db.py --lead-id 101 --file LEAD-101_chat.txt --format txt`

### 14.5. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤ summaries

```
/root/mvp-auto-summary/exports/summaries/2026-02-20/
‚îú‚îÄ‚îÄ LEAD-101_call_10-30_2026-02-20.md    ‚Üê summary —Å–æ–∑–≤–æ–Ω–∞
‚îú‚îÄ‚îÄ LEAD-101_chat_2026-02-20.md          ‚Üê summary —á–∞—Ç–∞
‚îú‚îÄ‚îÄ LEAD-101_combined_2026-02-20.md      ‚Üê –æ–±—ä–µ–¥–∏–Ω—ë–Ω–Ω–æ–µ
‚îú‚îÄ‚îÄ LEAD-102_call_14-00_2026-02-20.md
‚îú‚îÄ‚îÄ LEAD-102_combined_2026-02-20.md
‚îî‚îÄ‚îÄ daily_digest_2026-02-20.md           ‚Üê –∫—Ä–∞—Ç–∫–∏–π –¥–∞–π–¥–∂–µ—Å—Ç –¥–ª—è Telegram
```

### 14.6. –ü–æ–ª–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫ –¥–µ–π—Å—Ç–≤–∏–π –Ω–∞ 2026-02-20

```bash
# 1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ (–æ–¥–∏–Ω —Ä–∞–∑):
bash /root/mvp-auto-summary/scripts/setup_server_2026-02-20.sh

# 2. –ó–∞–≥—Ä—É–∑–∏—Ç—å –∞—É–¥–∏–æ —á–µ—Ä–µ–∑ WinSCP:
#    /mnt/recordings/2026/02/20/101_2026-02-20_10-30.mp3

# 3. –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—é (Workflow 01 –≤ n8n UI):
#    http://84.252.100.93:5678 ‚Üí Workflow 01 ‚Üí Execute

# 4. –ó–∞–≥—Ä—É–∑–∏—Ç—å —á–∞—Ç—ã:
python3 export_telegram_chat.py --chat "@–∫–ª–∏–µ–Ω—Ç" --lead-id 101 ...
python3 import_chat_to_db.py --lead-id 101 --file LEAD-101_chat.json ...

# 5. –ì–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å summaries:
python3 generate_individual_summary.py --lead-id all --source both --db-password –ü–ê–†–û–õ–¨

# 6. –§–∏–Ω–∞–ª—å–Ω—ã–π –¥–∞–π–¥–∂–µ—Å—Ç:
python3 combine_client_data.py --send-telegram --bot-token –¢–û–ö–ï–ù --chat-id -1003872092456
```

---

---

## 15. –°—Ç–∞—Ç—É—Å –Ω–∞ 2026-02-20 (—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏)

### –°–µ—Å—Å–∏—è 4 ‚Äî —á—Ç–æ —Å–¥–µ–ª–∞–Ω–æ (2026-02-20, —É—Ç—Ä–æ)

| –î–µ–π—Å—Ç–≤–∏–µ | –†–µ–∑—É–ª—å—Ç–∞—Ç |
|----------|-----------|
| –ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω —Ä–∞–±–æ—á–∏–π Telegram –∞–∫–∫–∞—É–Ω—Ç (session_evgenii) | ‚úÖ |
| –í—ã–≥—Ä—É–∂–µ–Ω—ã 6 —á–∞—Ç–æ–≤ —á–µ—Ä–µ–∑ export_telegram_chat.py | ‚úÖ 3153 —Å–æ–æ–±—â–µ–Ω–∏—è —Å—É–º–º–∞—Ä–Ω–æ |
| –ó–∞–ª–∏—Ç—ã –≤ PostgreSQL (chat_messages) | ‚úÖ |
| –ó–∞–ø–æ–ª–Ω–µ–Ω–∞ —Ç–∞–±–ª–∏—Ü–∞ lead_chat_mapping | ‚úÖ 6 –∑–∞–ø–∏—Å–µ–π |
| –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω—ã summaries (--all-history) –ø–æ –≤—Å–µ–π –∏—Å—Ç–æ—Ä–∏–∏ | ‚úÖ 6 .md —Ñ–∞–π–ª–æ–≤ |
| –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `curators` –≤ lead_chat_mapping | ‚úÖ (–ø—É—Å—Ç–æ–µ, –∑–∞–ø–æ–ª–Ω–∏—Ç—å –≤—Ä—É—á–Ω—É—é) |
| ffmpeg —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π –±–∏–Ω–∞—Ä—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –Ω–∞ —Ö–æ—Å—Ç–µ | ‚úÖ `/usr/local/bin/ffmpeg` v7.0.2-static |
| ffmpeg –ø—Ä–æ–±—Ä–æ—à–µ–Ω –≤ n8n –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —á–µ—Ä–µ–∑ volume | ‚úÖ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ |
| Workflow 01 –æ–±–Ω–æ–≤–ª—ë–Ω: ffmpeg ‚Üí ogg ‚Üí Whisper | ‚úÖ (–æ–±–∞ —É–∑–ª–∞ –æ–±–Ω–æ–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ API) |
| Workflow 01 –æ–±–Ω–æ–≤–ª—ë–Ω: —Ñ–∏–ª—å—Ç—Ä —Ñ–∞–π–ª–æ–≤ > 100MB | ‚úÖ |
| Workflow 01 –æ–±–Ω–æ–≤–ª—ë–Ω: –ø–æ–¥–¥–µ—Ä–∂–∫–∞ —Ç–∏—Ä–µ –≤ –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞ | ‚úÖ `4590-—Ñ—Ñ.webm` ‚Üí lead_id=4590 |
| –î—É–±–ª–∏—Ä—É—é—â–∏–µ workflows –¥–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω—ã | ‚úÖ –∞–∫—Ç–∏–≤–µ–Ω —Ç–æ–ª—å–∫–æ ZCtnggR6qrPy7bS6 |
| Whisper –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω (v1.4.0, medium –º–æ–¥–µ–ª—å) | ‚úÖ faster-whisper v1.0.1 |
| –ó–∞–≤–∏—Å—à–∏–µ `transcribing` –∑–∞–ø–∏—Å–∏ —Å–±—Ä–æ—à–µ–Ω—ã | ‚úÖ processed_files —á–∏—Å—Ç—ã–π |
| docker-compose.yml —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω —Å —Å–µ—Ä–≤–µ—Ä–æ–º | ‚úÖ |

### –î–æ–≥–æ–≤–æ—Ä—ã –≤ —Å–∏—Å—Ç–µ–º–µ

–ü–æ–¥—Ä–æ–±–Ω–µ–µ: —Å–º. `docs/CONTRACTS_AND_RAG.md`

| lead_id | –ß–∞—Ç | –°–æ–æ–±—â–µ–Ω–∏–π | –ö—É—Ä–∞—Ç–æ—Ä |
|---------|-----|-----------|---------|
| 4405 | –§—É–ª—Ñ–∏–ª–º–µ–Ω—Ç –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ –§–§-4405 | 1463 | ? |
| 987 | –§—É–ª—Ñ–∏–ª–º–µ–Ω—Ç –§–§-987 | 297 | ? |
| 1381 | –§–§-1381_–¢–ú–ü/–Æ–Ω–Ω–∞ | 1341 | ? |
| 2048 | –ê–ª–µ–∫—Å–∞–Ω–¥—Ä –§–§-2048 | 2 | ? |
| 4550 | –ê–ª–µ–∫—Å–∞–Ω–¥—Ä –§–§-4550 | 38 | ? |
| 506 | –Æ–ª–∏—è –§–§-506 | 12 | ? |

> **–ù—É–∂–Ω–æ –∑–∞–ø–æ–ª–Ω–∏—Ç—å**: –ø–æ–ª–µ `curators` –≤ —Ç–∞–±–ª–∏—Ü–µ `lead_chat_mapping`. –°–ø—Ä–æ—Å–∏—Ç—å —É —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—è.

### –†–µ–∞–ª—å–Ω—ã–µ –∞—É–¥–∏–æ–∑–∞–ø–∏—Å–∏ –≤ /mnt/recordings/2026/02/20/

| –§–∞–π–ª | –†–∞–∑–º–µ—Ä | lead_id | –°—Ç–∞—Ç—É—Å |
|------|--------|---------|--------|
| 4590-—Ñ—Ñ.webm | 47MB | 4590 | ‚è≥ –æ–∂–∏–¥–∞–µ—Ç (< 100MB, –±—É–¥–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∞–Ω) |
| 1000023_—Ä–∞–∫—É—Ä—Å —Ç–µ—Ö–Ω–æ.webm | 71MB | 1000023 | ‚è≥ –æ–∂–∏–¥–∞–µ—Ç (–Ω–µ—Ç –≤ lead_chat_mapping) |
| 2026-02-13T15_31_43.482Z.webm | 19MB | UNKNOWN | ‚è≥ –æ–∂–∏–¥–∞–µ—Ç (–Ω–µ—Ç LEAD_ID) |
| 2048-–§–§.webm | 187MB | 2048 | ‚ùå –ø—Ä–æ–ø—É—â–µ–Ω (> 100MB) |
| 2239-—Ñ—Ñ.webm | 414MB | 2239 | ‚ùå –ø—Ä–æ–ø—É—â–µ–Ω (> 100MB) |
| 1000097_2026-02-13.webm | 978MB | 1000097 | ‚ùå –ø—Ä–æ–ø—É—â–µ–Ω (> 100MB) |
| 0_–ø—É—Ç—å_–ø–∏—Å–∞—Ç.webm | 298MB | UNKNOWN | ‚ùå –ø—Ä–æ–ø—É—â–µ–Ω (> 100MB) |

> **–ë–æ–ª—å—à–∏–µ —Ñ–∞–π–ª—ã** (> 100MB) –ø—Ä–µ–≤—ã—à–∞—é—Ç n8n execution timeout (30 –º–∏–Ω –ø—Ä–∏ —Å–∫–æ—Ä–æ—Å—Ç–∏ 1.5x).
> –î–ª—è –Ω–∏—Ö –Ω—É–∂–Ω–∞ –æ—Ç–¥–µ–ª—å–Ω–∞—è —Ä—É—á–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏–ª–∏ —É–≤–µ–ª–∏—á–µ–Ω–∏–µ EXECUTIONS_TIMEOUT.

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å Whisper (–∏–∑–º–µ—Ä–µ–Ω–æ 2026-02-20)

- **–ú–æ–¥–µ–ª—å**: medium (faster-whisper v1.0.1, CPU-only)
- **–°–∫–æ—Ä–æ—Å—Ç—å**: ~1.5x —Ä–µ–∞–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ (45 —Å–µ–∫ –Ω–∞ 30 —Å–µ–∫ –∞—É–¥–∏–æ)
- **–ö–∞—á–µ—Å—Ç–≤–æ**: –æ—Ç–ª–∏—á–Ω–æ–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ —Ä—É—Å—Å–∫–æ–≥–æ (–ø—Ä–∏–º–µ—Ä: `"–¢–æ –µ—Å—Ç—å –≤—ã –µ—â–µ —Ä–∞–Ω–µ–µ, –¥–∞, —Ä–∞–±–æ—Ç–∞–ª–∏?"`)
- **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è**: —Ñ–∞–π–ª—ã > 30 –º–∏–Ω—É—Ç –Ω–µ –≤–ª–µ–∑–∞—é—Ç –≤ 30-–º–∏–Ω—É—Ç–Ω—ã–π n8n —Ç–∞–π–º–∞—É—Ç

### –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –¥–∞–ª—å—à–µ

| –ó–∞–¥–∞—á–∞ | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç | –ö—Ç–æ –¥–µ–ª–∞–µ—Ç |
|--------|-----------|------------|
| –ó–∞–ø—É—Å—Ç–∏—Ç—å Workflow 01 –≤—Ä—É—á–Ω—É—é (–∫–Ω–æ–ø–∫–∞ Execute –≤ n8n UI) | üî¥ HIGH | –í—Ä—É—á–Ω—É—é |
| –ó–∞–ø–æ–ª–Ω–∏—Ç—å –ø–æ–ª–µ `curators` –≤ lead_chat_mapping | üü° MEDIUM | –í—Ä—É—á–Ω—É—é (—Å–ø—Ä–æ—Å–∏—Ç—å —É —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—è) |
| –ü–µ—Ä–µ—Ä–∞–±–æ—Ç–∞—Ç—å –ø—Ä–æ–º–ø—Ç—ã GLM-4 (STATS_JSON + SUMMARY_MD) | üü° MEDIUM | –ê–≤—Ç–æ |
| –ù–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç Telegram-–¥–∞–π–¥–∂–µ—Å—Ç–∞ (–ø–æ –∫—É—Ä–∞—Ç–æ—Ä–∞–º) | üü° MEDIUM | –ê–≤—Ç–æ |
| –ü–æ–¥–Ω—è—Ç—å nginx –Ω–∞ –ø–æ—Ä—Ç—É 8080 –¥–ª—è —Ä–∞–∑–¥–∞—á–∏ .md —Ñ–∞–π–ª–æ–≤ | üü° MEDIUM | –ê–≤—Ç–æ |
| –û–±—Ä–∞–±–æ—Ç–∞—Ç—å –±–æ–ª—å—à–∏–µ —Ñ–∞–π–ª—ã (> 100MB) –≤—Ä—É—á–Ω—É—é | üü† LOW | –í—Ä—É—á–Ω—É—é / –ê–≤—Ç–æ |

---

## 16. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ ffmpeg –≤ n8n (2026-02-20)

### –ü—Ä–æ–±–ª–µ–º–∞

n8n –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Docker Hardened Images –Ω–∞ Alpine (musl libc). Ubuntu-—Å–∏—Å—Ç–µ–º–Ω—ã–π ffmpeg (glibc) –Ω–µ—Å–æ–≤–º–µ—Å—Ç–∏–º.

### –†–µ—à–µ–Ω–∏–µ

–°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π ffmpeg –±–∏–Ω–∞—Ä—å (musl-—Å–æ–≤–º–µ—Å—Ç–∏–º—ã–π) –º–æ–Ω—Ç–∏—Ä—É–µ—Ç—Å—è –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä:

```
–•–æ—Å—Ç: /usr/local/bin/ffmpeg   (johnvansickle.com, v7.0.2-static, 77MB)
    ‚Üì volume mount (read-only)
–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä n8n: /usr/bin/ffmpeg   (—Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞—Ç–∏–≤–Ω–æ –±–µ–∑ –¥–æ–ø. –±–∏–±–ª–∏–æ—Ç–µ–∫)
```

docker-compose.yml:
```yaml
volumes:
  - /usr/local/bin/ffmpeg:/usr/bin/ffmpeg:ro   # —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π (musl-—Å–æ–≤–º–µ—Å—Ç–∏–º—ã–π)
```

### Pipeline —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏–∏ (–æ–±–Ω–æ–≤–ª—ë–Ω)

```
.webm —Ñ–∞–π–ª (–¥–æ 100MB)
    ‚Üì ffmpeg (–≤–Ω—É—Ç—Ä–∏ n8n –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞)
    ‚Üì -vn -acodec libopus -b:a 32k ‚Üí /tmp/audio_TIMESTAMP.ogg
    ‚Üì curl POST http://whisper:9000/asr
    ‚Üì JSON { text: "—Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∞..." }
    ‚Üì rm /tmp/audio_TIMESTAMP.ogg
    ‚Üí PostgreSQL processed_files (status=completed)
    ‚Üí open-notebook (—Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç)
```

---

*Document created: 2026-02-18 | Updated: 2026-02-20 (—Å–µ—Å—Å–∏—è 4) ‚Äî ffmpeg fix, —Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ, –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å Whisper*
