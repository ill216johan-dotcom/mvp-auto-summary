# Настройка .env — Пошаговая инструкция

> **Для кого:** Человек без технического опыта
> **Время:** 20 минут
> **Задача:** Заполнить переменные окружения для запуска MVP Auto-Summary

---

## Что это вообще такое?

`.env` — это файл с настройками. В нём написано:
- Какой пароль у n8n (ты туда заходишь один раз)
- Какой API ключ от GLM-4 (для нейросети)
- Какой токен у Telegram бота (куда слать отчёты)

**Важно:** Пароли можно придумать любые, главное — запомнить их или записать.

---

## Справочная информация

| Что | Зачем нужно | Насколько сложно |
|-----|-------------|------------------|
| Пароли (n8n, PostgreSQL, SurrealDB) | Защита доступа к системе | Легко — просто придумать |
| Ключ шифрования | Шифрование данных в n8n | Легко — команда копировать |
| IP сервера | Чтобы n8n знал, где он запущен | Легко — одна команда |
| GLM-4 API ключ | Суммаризация звонков через нейросеть | Средне — регистрация на сайте |
| Telegram Bot Token | Отправка дайджестов в чат | Средне — бот в Telegram |
| Telegram Chat ID | Куда слать дайджесты | Средне — API вызов |

**Итог:** Нужно получить 3 вещи снаружи (GLM-4, Telegram Bot, Telegram Chat ID), остальное придумать самому.

---

## Шаг 1: Узнай IP сервера (2 минуты)

### В терминале сервера выполни:

```bash
curl -s ifconfig.me
```

Появится что-то вроде: `185.12.34.56`

**Что делать:** Скопируй IP и вставь сюда (в .env):

```
N8N_WEBHOOK_URL=http://185.12.34.56:5678
```

**Что это:** Адрес твоего сервера в интернете. Нужен, чтобы n8n знал, где он работает.

---

## Шаг 2: Сгенерируй ключ шифрования (1 минута)

### В терминале сервера выполни:

```bash
openssl rand -hex 16
```

Появится что-то вроде: `a1b2c3d4e5f67890abcdef1234567890`

**Что делать:** Скопируй эту строку и вставь в .env:

```
N8N_ENCRYPTION_KEY=a1b2c3d4e5f67890abcdef1234567890
```

**Что это:** Ключ для шифрования данных в n8n. Нужен для безопасности.

---

## Шаг 3: Придумай пароли (2 минуты)

Придумай три пароля. Можешь использовать одинаковые, чтобы не запутаться.

### Пример паролей:

```
mvp12345!
SuperSecret2026!
MyProjectPassword99!
```

**Что делать:** Вставь их в .env:

```
N8N_PASSWORD=mvp12345!
POSTGRES_PASSWORD=mvp12345!
SURREAL_PASSWORD=mvp12345!
```

**Что это:**
- `N8N_PASSWORD` — пароль для входа в n8n (зайдёшь один раз)
- `POSTGRES_PASSWORD` — пароль базы данных
- `SURREAL_PASSWORD` — пароль базы данных для open-notebook

**⚠️ Важно:** Запиши пароли куда-нибудь (в заметки, в Telegram), чтобы не забыть!

---

## Шаг 4: Получи API ключ GLM-4 (5 минут)

### Зачем нужно:
Нейросеть GLM-4 будет суммаризировать звонки. Без API ключа не будет работать.

### Инструкция:

#### 4.1 Перейди на сайт
Открой в браузере: https://z.ai

#### 4.2 Зарегистрируйся
1. Нажми "Sign Up" или "Зарегистрироваться"
2. Введи email и пароль
3. Подтверди почту

#### 4.3 Создай API ключ
1. После входа перейди в раздел **"API Keys"**
2. Нажми **"Create New Key"** или **"Создать новый ключ"**
3. Придумай название (например: `MVP Auto-Summary`)
4. Скопируй ключ (похож на: `abc123def456ghi789jkl012mno345pqr`)

#### 4.4 Вставь в .env

```
GLM4_API_KEY=abc123def456ghi789jkl012mno345pqr
```

**Что это:** API ключ для обращения к нейросети GLM-4. Каждый раз, когда система будет суммаризировать звонок, будет использоваться этот ключ.

---

## Шаг 5: Создай Telegram бота (5 минут)

### Зачем нужно:
Бот будет отправлять дайджесты (краткие отчёты) в чат кураторов.

### Инструкция:

#### 5.1 Откри Telegram
Телефон или компьютер — не важно.

#### 5.2 Найди BotFather
1. В поиске Telegram введи: `@BotFather`
2. Открой чат с ним

#### 5.3 Создай бота
1. Отправь команду: `/newbot`
2. BotFather спросит имя бота — введи любое (например: `MVP Summary Bot`)
3. BotFather спросит юзернейм — введи уникальный (например: `MVP_Summary_Bot_2026_bot`)
4. BotFather пришлёт сообщение с токеном (похож на: `7123456789:AAFP4g9h8j7k6l5m4n3o2p1q0r9s8t7u6v`)
5. **СКОПИРУЙ ТОКЕН!**

#### 5.4 Вставь в .env

```
TELEGRAM_BOT_TOKEN=7123456789:AAFP4g9h8j7k6l5m4n3o2p1q0r9s8t7u6v
```

**Что это:** Токен — это "пароль" твоего бота. С его помощью система будет отправлять сообщения от имени бота.

---

## Шаг 6: Получи Chat ID чата кураторов (5 минут)

### Зачем нужно:
Система должна знать, В КАКОЙ чат слать дайджесты. Chat ID — это уникальный номер чата.

### Инструкция:

#### 6.1 Добавь бота в чат кураторов
1. Открой групповой чат с кураторами в Telegram
2. Нажми на название чата → "Участники" или "Members"
3. Нажми "Добавить участника" или "Add Member"
4. Введи юзернейм бота (например: `@MVP_Summary_Bot_2026_bot`)
5. Добавь его в чат

#### 6.2 Отправь тестовое сообщение
Напиши в чат любое сообщение (например: "Тест")

#### 6.3 Получи Chat ID
1. Открой браузер
2. Вставь этот URL (замени `ТЕГ_ТОКЕН` на токен из шага 5):

```
https://api.telegram.org/botТЕГ_ТОКЕН_ИЗ_ШАГА_5/getUpdates
```

Пример (вместо `7123456789:AAFP...` вставь свой токен):
```
https://api.telegram.org/bot7123456789:AAFP4g9h8j7k6l5m4n3o2p1q0r9s8t7u6v/getUpdates
```

3. Открой страницу
4. Найди в тексте `"id":-1001234567890` — это твой Chat ID
5. Скопируй число после `"id":`

#### 6.4 Вставь в .env

```
TELEGRAM_CHAT_ID=-1001234567890
```

**Что это:** Уникальный номер чата, куда слать дайджесты. Без него бот не будет знать, куда писать.

---

## Готовый пример .env файла

Когда все шаги выполнены, твой .env должен выглядеть примерно так:

```bash
# ============================================================
# MVP Auto-Summary — Environment Variables
# ============================================================

# --- General ---
TIMEZONE=Europe/Moscow

# --- n8n ---
N8N_PORT=5678
N8N_USER=admin
N8N_PASSWORD=mvp12345!
N8N_ENCRYPTION_KEY=a1b2c3d4e5f67890abcdef1234567890
N8N_WEBHOOK_URL=http://185.12.34.56:5678

# --- PostgreSQL ---
POSTGRES_PORT=5432
POSTGRES_USER=n8n
POSTGRES_PASSWORD=mvp12345!
POSTGRES_DB=n8n

# --- SurrealDB (for open-notebook) ---
SURREAL_PORT=8000
SURREAL_USER=root
SURREAL_PASSWORD=mvp12345!

# --- open-notebook ---
NOTEBOOK_PORT=8888
NOTEBOOK_DEFAULT_MODEL=openai/glm-4.7-flashx
NOTEBOOK_EMBEDDING_MODEL=
OPEN_NOTEBOOK_URL=http://open-notebook:8888
OPEN_NOTEBOOK_TOKEN=password

# --- Whisper (self-hosted STT) ---
WHISPER_PORT=9000
WHISPER_MODEL=medium

# --- GLM-4 (ZhipuAI) ---
GLM4_API_KEY=abc123def456ghi789jkl012mno345pqr
GLM4_BASE_URL=https://api.z.ai/api/paas/v4
GLM4_MODEL=glm-4.7-flashx

# --- Telegram ---
TELEGRAM_BOT_TOKEN=7123456789:AAFP4g9h8j7k6l5m4n3o2p1q0r9s8t7u6v
TELEGRAM_CHAT_ID=-1001234567890
```

---

## Проверка перед запуском

Перед запуском убедись, что ВСЕ заглушки заменены:

✅ `N8N_PASSWORD` заменён на твой пароль
✅ `N8N_ENCRYPTION_KEY` заменён на вывод команды `openssl rand -hex 16`
✅ `N8N_WEBHOOK_URL` заменён на твой IP сервера
✅ `POSTGRES_PASSWORD` заменён на твой пароль
✅ `SURREAL_PASSWORD` заменён на твой пароль
✅ `GLM4_API_KEY` заменён на ключ от z.ai
✅ `TELEGRAM_BOT_TOKEN` заменён на токен от @BotFather
✅ `TELEGRAM_CHAT_ID` заменён на chat_id чата кураторов

---

## Как сохранить .env

Если редактируешь через `nano`:

1. Нажми `Ctrl + O` → затем `Enter` (сохранить)
2. Нажми `Ctrl + X` (выйти)

---

## Запуск системы

После того как .env сохранён:

```bash
docker compose up -d
```

Подожди 1-2 минуты, пока всё запустится.

Проверь статус:

```bash
docker compose ps
```

Все сервисы должны быть в статусе `Up`.

---

## Что дальше?

После запуска нужно:

1. Проверить, что сервисы работают (5 минут)
2. Импортировать workflows в n8n (5 минут)
3. Активировать workflows (5 минут)

Эти шаги я помогу сделать — они простые.

---

## Если что-то не работает

### Проблема: Не могу получить IP сервера
**Решение:** Попробуй команды:
```bash
curl ifconfig.me
curl icanhazip.com
hostname -I
```

### Проблема: Не могу сгенерировать ключ шифрования
**Решение:** Убедись, что установлен OpenSSL:
```bash
openssl version
```
Если не установлен — установи:
```bash
apt install -y openssl
```

### Проблема: Не могу зарегистрироваться на z.ai
**Решение:**
1. Попробуй VPN (сайт может блокировать некоторые страны)
2. Используй другой браузер
3. Проверь, правильно ли введён email

### Проблема: BotFather не отвечает
**Решение:**
1. Убедись, что правильно отправлена команда `/newbot`
2. Попробуй переподключиться к Telegram
3. Проверь интернет

### Проблема: Не могу получить Chat ID
**Решение:**
1. Убедись, что правильно скопирован токен в URL
2. Убедись, что бот добавлен в чат
3. Отправь новое сообщение в чат и перезагрузи страницу getUpdates

### Проблема: Docker не запускается
**Решение:**
```bash
docker compose logs
```
Посмотри, какая ошибка. Чаще всего проблема в неправильном пароле или токене.

---

## Контакты для помощи

Если что-то не понятно — напиши мне. Объясню подробнее!

---

*Создано: 2026-02-18*
*Версия: 1.0*
