# ะกะธััะตะผะฐ ะดะพะณะพะฒะพัะพะฒ ะธ ะฟะตััะพะฝะฐะปะธะทะธัะพะฒะฐะฝะฝัะน RAG

> ะะพะบัะผะตะฝั ะพะฟะธััะฒะฐะตั: ะบะฐะบ ััััะพะตะฝะฐ ะฝัะผะตัะฐัะธั ะดะพะณะพะฒะพัะพะฒ, ะบะฐะบ ะพะฝะฐ ัะฒัะทะฐะฝะฐ ั ะดะฐะฝะฝัะผะธ ัะธััะตะผั,
> ะธ ะบะฐะบ open-notebook ัะตะฐะปะธะทัะตั ะฟะตััะพะฝะฐะปะธะทะธัะพะฒะฐะฝะฝัั RAG-ัะธััะตะผั ะดะปั ะบะฐะถะดะพะณะพ ะบะปะธะตะฝัะฐ.
>
> ะกะพะทะดะฐะฝ: 2026-02-20

---

## 1. ะัะผะตัะฐัะธั ะดะพะณะพะฒะพัะพะฒ (lead_id)

### ะคะพัะผะฐั

ะ ัะธััะตะผะต ะธัะฟะพะปัะทัะตััั ะตะดะธะฝัะน ะธะดะตะฝัะธัะธะบะฐัะพั ะบะปะธะตะฝัะฐ โ **lead_id**.

ะ ะบะพะผะฟะฐะฝะธะธ ััะพ ะฝะพะผะตั ะดะพะณะพะฒะพัะฐ ั ะฟัะตัะธะบัะพะผ **ะคะค-**:

```
ะคะค-4405    โ   lead_id = "4405"
ะคะค-987     โ   lead_id = "987"
ะคะค-1381    โ   lead_id = "1381"
```

ะะพ ะฒัะตั ัะบัะธะฟัะฐั ะธ ะฑะฐะทะต ะดะฐะฝะฝัั **ััะฐะฝะธััั ัะพะปัะบะพ ัะธัะปะพ** โ ะฑะตะท ะฟัะตัะธะบัะฐ "ะคะค-".
ะัะตัะธะบั ะดะพะฑะฐะฒะปัะตััั ัะพะปัะบะพ ะฟัะธ ะพัะพะฑัะฐะถะตะฝะธะธ (ะฒ Telegram-ะดะฐะนะดะถะตััะต, ะฒ ะฝะฐะทะฒะฐะฝะธัั ัะฐะนะปะพะฒ).

### ะะดะต ะธัะฟะพะปัะทัะตััั lead_id

| ะะดะต | ะคะพัะผะฐั | ะัะธะผะตั |
|-----|--------|--------|
| ะะผั ัะฐะนะปะฐ ะฐัะดะธะพะทะฐะฟะธัะธ | `{lead_id}_...mp3` | `4405_2026-02-20_10-30.mp3` |
| ะขะฐะฑะปะธัะฐ `processed_files` | `lead_id VARCHAR(50)` | `"4405"` |
| ะขะฐะฑะปะธัะฐ `chat_messages` | `lead_id VARCHAR(50)` | `"4405"` |
| ะขะฐะฑะปะธัะฐ `client_summaries` | `lead_id VARCHAR(50)` | `"4405"` |
| ะขะฐะฑะปะธัะฐ `lead_chat_mapping` | `lead_id VARCHAR(50)` | `"4405"` |
| open-notebook: ะธะผั ะฑะปะพะบะฝะพัะฐ | `LEAD-{lead_id}` | `LEAD-4405` |
| ะคะฐะนะปั summaries | `LEAD-{lead_id}_...md` | `LEAD-4405_chat_2026-02-20.md` |

### ะขะตะบััะธะต ะดะพะณะพะฒะพัั ะฒ ัะธััะตะผะต (ะทะฐะปะธัะพ 2026-02-20)

| lead_id | ะะฐะทะฒะฐะฝะธะต | ะขะธะฟ ัะฐัะฐ | ะกะพะพะฑัะตะฝะธะน |
|---------|----------|----------|-----------|
| 4405 | ะคัะปัะธะปะผะตะฝั ะะปะฐััะพัะผะฐ ะคะค-4405 | ะณััะฟะฟะฐ | 1463 |
| 987 | ะคัะปัะธะปะผะตะฝั ะคะค-987 | ะณััะฟะฟะฐ | 297 |
| 1381 | ะคะค ะะปะฐััะพัะผะฐ&ะคะค-1381_ะขะะ/ะฎะฝะฝะฐ | ััะฟะตัะณััะฟะฟะฐ | 1341 |
| 2048 | ะะปะตะบัะฐะฝะดั ะคะค-2048 | ะปะธัะฝัะน | 2 |
| 4550 | ะะปะตะบัะฐะฝะดั ะคะค-4550 | ะปะธัะฝัะน | 38 |
| 506 | ะฎะปะธั ะคะค-506 | ะปะธัะฝัะน | 12 |

---

## 2. ะัะธะฝัะธะฟ: ะพะดะธะฝ ะบะปะธะตะฝั = ะพะดะธะฝ ะฑะปะพะบะฝะพั ะฒ open-notebook

ะะฐะถะดัะน ะดะพะณะพะฒะพั (lead_id) ะธะผะตะตั **ะพะดะธะฝ ะฟะตััะพะฝะฐะปัะฝัะน ะฑะปะพะบะฝะพั** ะฒ open-notebook.
ะะปะพะบะฝะพั ะฝะฐะทัะฒะฐะตััั `LEAD-{lead_id}` (ะฝะฐะฟัะธะผะตั `LEAD-4405`).

ะ ััะพั ะฑะปะพะบะฝะพั ะดะพะฑะฐะฒะปััััั **ะฒัะต ะธััะพัะฝะธะบะธ ะธะฝัะพัะผะฐัะธะธ ะฟะพ ะบะปะธะตะฝัั**:

```
LEAD-4405 (ะฑะปะพะบะฝะพั ะฒ open-notebook)
โโโ ะััะพัะฝะธะบ: ััะฐะฝัะบัะธะฟั ัะพะทะฒะพะฝะฐ 2026-02-20 10:30 (ัะธะฟ: text)
โโโ ะััะพัะฝะธะบ: ััะฐะฝัะบัะธะฟั ัะพะทะฒะพะฝะฐ 2026-02-15 14:00 (ัะธะฟ: text)
โโโ ะััะพัะฝะธะบ: ะธััะพัะธั Telegram ัะฐัะฐ (ัะธะฟ: text)
โโโ ะััะพัะฝะธะบ: summary ะทะฐ 2026-02-20 (ัะธะฟ: text)
```

ะะพะณะดะฐ ะบััะฐัะพั ะทะฐะดะฐัั ะฒะพะฟัะพั ะฟะพ ะบะปะธะตะฝัั โ open-notebook ะดะตะปะฐะตั ะฒะตะบัะพัะฝัะน ะฟะพะธัะบ **ัะพะปัะบะพ ะฟะพ ะธััะพัะฝะธะบะฐะผ ััะพะณะพ ะฑะปะพะบะฝะพัะฐ**, ะฝะต ัะผะตัะธะฒะฐั ั ะดััะณะธะผะธ ะบะปะธะตะฝัะฐะผะธ.

---

## 3. ะััะพัะฝะธะบะธ ะดะฐะฝะฝัั ะธ ะธั ัะผะตัะตะฝะธะต ะฒ RAG

### ะขัะธ ัะธะฟะฐ ะธััะพัะฝะธะบะพะฒ

| ะััะพัะฝะธะบ | ะัะบัะดะฐ ะฑะตััััั | ะะพะณะดะฐ ะดะพะฑะฐะฒะปัะตััั ะฒ ะฑะปะพะบะฝะพั |
|----------|---------------|----------------------------|
| **ะขัะฐะฝัะบัะธะฟั ัะพะทะฒะพะฝะฐ** | Whisper STT โ PostgreSQL `processed_files` | ะะฒัะพะผะฐัะธัะตัะบะธ ัะตัะตะท Workflow 01, ััะฐะทั ะฟะพัะปะต ััะฐะฝัะบัะธะฟัะธะธ |
| **ะััะพัะธั Telegram ัะฐัะฐ** | Telethon โ PostgreSQL `chat_messages` | ะัััะฝัั ะธะปะธ ะฟะพ ัะฐัะฟะธัะฐะฝะธั ัะตัะตะท `export_telegram_chat.py` |
| **Summary (ัะตะทัะผะต ะดะฝั)** | GLM-4 โ PostgreSQL `client_summaries` | ะะถะตะดะฝะตะฒะฝะพ ะฒ 22:00 ัะตัะตะท Workflow 03 |

### ะะฐะบ ััะพ ะฒัะณะปัะดะธั ะฒ open-notebook

ะะฐะถะดัะน ะธััะพัะฝะธะบ ะดะพะฑะฐะฒะปัะตััั ะบะฐะบ ะพัะดะตะปัะฝัะน **ัะตะบััะพะฒัะน ะฑะปะพะบ** ั ะผะตัะบะฐะผะธ:

```
[ะกะะะะะ 2026-02-20 10:30]
ะฃัะฐััะฝะธะบะธ: ะะฒะณะตะฝะธะน ะคะค, ะฎะปะธั (ะบะปะธะตะฝั)
...ัะตะบัั ััะฐะฝัะบัะธะฟัะฐ...

[ะงะะข Telegram 2026-02-20]
ะคัะปัะธะปะผะตะฝั ะะปะฐััะพัะผะฐ ะคะค-4405
...ะธััะพัะธั ะฟะตัะตะฟะธัะบะธ ะทะฐ ะดะตะฝั...

[SUMMARY 2026-02-20]
## ะะปััะตะฒัะต ะดะพะณะพะฒะพััะฝะฝะพััะธ
- ะะปะธะตะฝั ะถะดัั ะพัะณััะทะบั ะดะพ ะฟััะฝะธัั
...
```

### ะะฐะบ RAG ัะผะตัะธะฒะฐะตั ะธััะพัะฝะธะบะธ

ะัะธ ะทะฐะฟัะพัะต ะบััะฐัะพัะฐ ("ะ ััะผ ะดะพะณะพะฒะพัะธะปะธัั ะฝะฐ ะฟัะพัะปะพะน ะฝะตะดะตะปะต?") open-notebook:

1. **ะะตะบัะพัะฝัะน ะฟะพะธัะบ** โ ะธัะตั ัะตะปะตะฒะฐะฝัะฝัะต ััะฐะณะผะตะฝัั ะฟะพ ะฒัะตะผ ะธััะพัะฝะธะบะฐะผ ะฑะปะพะบะฝะพัะฐ
2. **ะะฐะฝะถะธัะพะฒะฐะฝะธะต** โ ััะฐะณะผะตะฝัั ะธะท ัะฐะทะฝัั ะธััะพัะฝะธะบะพะฒ (ัะพะทะฒะพะฝ + ัะฐั + summary) ะฟะพะฟะฐะดะฐัั ะฒ ะบะพะฝัะตะบัั ะฒะผะตััะต
3. **GLM-4 ัะธะฝัะตะท** โ ะผะพะดะตะปั ะฒะธะดะธั ััะฐะณะผะตะฝัั ะธะท ะฒัะตั ะธััะพัะฝะธะบะพะฒ ะธ ัะพัะผะธััะตั ะพัะฒะตั

```
ะะพะฟัะพั: "ะงัะพ ะพะฑััะถะดะฐะปะธ ั ะบะปะธะตะฝัะพะผ ะคะค-4405 ะฒ ัะตะฒัะฐะปะต?"
                    โ
                    โผ
        open-notebook ะฒะตะบัะพัะฝัะน ะฟะพะธัะบ
        ะฟะพ ะฑะปะพะบะฝะพัั LEAD-4405
                    โ
        โโโโโโโโโโโโโผโโโโโโโโโโโโ
        โผ           โผ           โผ
   [ะกะพะทะฒะพะฝ]    [Telegram]  [Summary]
   02.02.26    15.02.26    20.02.26
        โ           โ           โ
        โโโโโโโโโโโโโดโโโโโโโโโโโโ
                    โ
                    โผ
            GLM-4: ัะธะฝัะตะท ะพัะฒะตัะฐ
            ั ัะธัะฐัะฐะผะธ ะธะท ะธััะพัะฝะธะบะพะฒ
```

---

## 4. ะขะฐะฑะปะธัะฐ lead_chat_mapping โ ัะฒัะทั ะดะพะณะพะฒะพัะฐ ั Telegram

ะขะฐะฑะปะธัะฐ ััะฐะฝะธั ัะพะพัะฒะตัััะฒะธะต "ะฝะพะผะตั ะดะพะณะพะฒะพัะฐ โ Telegram ัะฐั".
ะะฐะฟะพะปะฝัะตััั **ะพะดะธะฝ ัะฐะท ะฒัััะฝัั** ะดะปั ะบะฐะถะดะพะณะพ ะบะปะธะตะฝัะฐ.

```sql
CREATE TABLE lead_chat_mapping (
    id SERIAL PRIMARY KEY,
    lead_id VARCHAR(50) NOT NULL,      -- ะฝะพะผะตั ะดะพะณะพะฒะพัะฐ: "4405"
    lead_name VARCHAR(255),            -- ะฝะฐะทะฒะฐะฝะธะต: "ะคะค-4405"
    chat_id BIGINT,                    -- Telegram chat_id: -4796144277
    chat_username VARCHAR(255),        -- @username (ะตัะปะธ ะตััั)
    chat_title VARCHAR(255),           -- ะฝะฐะทะฒะฐะฝะธะต ัะฐัะฐ ะฒ Telegram
    chat_type VARCHAR(20),             -- 'group', 'supergroup', 'private'
    active BOOLEAN DEFAULT TRUE,       -- ะผะพะถะฝะพ ะดะตะฐะบัะธะฒะธัะพะฒะฐัั ะฑะตะท ัะดะฐะปะตะฝะธั
    notes TEXT,                        -- ะฟัะพะธะทะฒะพะปัะฝัะต ะทะฐะผะตัะบะธ
    created_at TIMESTAMP DEFAULT NOW()
);
```

### ะขะตะบััะตะต ัะพะดะตัะถะธะผะพะต ัะฐะฑะปะธัั (ะทะฐะฟะพะปะฝะตะฝะพ 2026-02-20)

```sql
SELECT lead_id, lead_name, chat_id, chat_type FROM lead_chat_mapping;

 lead_id โ lead_name โ    chat_id      โ  chat_type
โโโโโโโโโโผโโโโโโโโโโโโผโโโโโโโโโโโโโโโโโโผโโโโโโโโโโโโ
 4405    โ ะคะค-4405   โ -4796144277     โ group
 987     โ ะคะค-987    โ -741397660      โ group
 1381    โ ะคะค-1381   โ -1002671287102  โ supergroup
 2048    โ ะคะค-2048   โ 2095416568      โ private
 4550    โ ะคะค-4550   โ 501890479       โ private
 506     โ ะคะค-506    โ 316512097       โ private
```

### ะะฐะบ ะดะพะฑะฐะฒะธัั ะฝะพะฒะพะณะพ ะบะปะธะตะฝัะฐ

```bash
docker exec mvp-auto-summary-postgres-1 psql -U n8n -d n8n -c "
INSERT INTO lead_chat_mapping (lead_id, lead_name, chat_id, chat_title, chat_type)
VALUES ('ะะะะซะ_ID', 'ะคะค-ะะะะซะ_ID', CHAT_ID_ะะ_ะกะะะกะะ, 'ะะฐะทะฒะฐะฝะธะต ัะฐัะฐ', 'group');
"
```

ะะดะต ะฒะทััั CHAT_ID: ะทะฐะฟัััะธัั `python3 list_telegram_chats.py --session session_evgenii`

---

## 5. ะะพะปะฝะฐั ััะตะผะฐ ะดะฐะฝะฝัั (ER-ะดะธะฐะณัะฐะผะผะฐ)

```
โโโโโโโโโโโโโโโโโโโโโโโ         โโโโโโโโโโโโโโโโโโโโโโโโ
โ   processed_files   โ         โ    chat_messages      โ
โโโโโโโโโโโโโโโโโโโโโโโ         โโโโโโโโโโโโโโโโโโโโโโโโ
โ id (PK)             โ         โ id (PK)               โ
โ lead_id โโโโโโโโโโโโโผโโโโโโ   โ lead_id โโโโโโโโโโโโโโโผโโโ
โ filename            โ     โ   โ chat_title            โ  โ
โ status              โ     โ   โ sender                โ  โ
โ transcript_text     โ     โ   โ message_text          โ  โ
โ created_at          โ     โ   โ message_date          โ  โ
โโโโโโโโโโโโโโโโโโโโโโโ     โ   โโโโโโโโโโโโโโโโโโโโโโโโ  โ
                             โ                             โ
                             โ   โโโโโโโโโโโโโโโโโโโโโโโโ  โ
                             โ   โ  client_summaries     โ  โ
                             โ   โโโโโโโโโโโโโโโโโโโโโโโโ  โ
                             โโโโโผโโ lead_id             โโโโ
                                 โ source_type           โ
                                 โ source_id             โ
                                 โ summary_text          โ
                                 โ summary_date          โ
                                 โโโโโโโโโโโโโโโโโโโโโโโโ
                                           โ
                                           โ lead_id
                                           โ
                             โโโโโโโโโโโโโโโผโโโโโโโโโโโโโ
                             โ    lead_chat_mapping      โ
                             โโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                             โ lead_id (key)             โ
                             โ lead_name                 โ
                             โ chat_id (Telegram)        โ
                             โ chat_type                 โ
                             โโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                                           โ
                                           โ lead_id
                                           โผ
                             โโโโโโโโโโโโโโโโโโโโโโโโโโโ
                             โ  open-notebook          โ
                             โ  ะะปะพะบะฝะพั: LEAD-{id}     โ
                             โโโโโโโโโโโโโโโโโโโโโโโโโโโ
                             โ source: ััะฐะฝัะบัะธะฟั      โ
                             โ source: ัะฐั             โ
                             โ source: summary         โ
                             โ                         โ
                             โ  RAG: ะฒะตะบัะพัะฝัะน ะฟะพะธัะบ   โ
                             โ  ะฟะพ ะฒัะตะผ ะธััะพัะฝะธะบะฐะผ     โ
                             โโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## 6. ะะฐะบ ะบััะฐัะพั ัะฐะฑะพัะฐะตั ั RAG (ะฟะพะปัะทะพะฒะฐัะตะปััะบะธะน ััะตะฝะฐัะธะน)

### ะกัะตะฝะฐัะธะน 1: "ะงัะพ ะฟัะพะธััะพะดะธั ั ะบะปะธะตะฝัะพะผ ะคะค-4405?"

1. ะััะฐัะพั ะพัะบััะฒะฐะตั `http://84.252.100.93:8888`
2. ะัะฑะธัะฐะตั ะฑะปะพะบะฝะพั `LEAD-4405`
3. ะะฐะดะฐัั ะฒะพะฟัะพั: *"ะะฐะบะธะต ะฟัะพะฑะปะตะผั ะฑัะปะธ ั ะบะปะธะตะฝัะฐ ะทะฐ ะฟะพัะปะตะดะฝะธะน ะผะตััั?"*
4. open-notebook ะธัะตั ะฟะพ ะฒัะตะผ ะธััะพัะฝะธะบะฐะผ (ัะพะทะฒะพะฝั + ัะฐั + summary)
5. ะัะฒะตัะฐะตั ั ัะธัะฐัะฐะผะธ ะธะท ะบะพะฝะบัะตัะฝัั ัะพะพะฑัะตะฝะธะน ะธ ััะฐะฝัะบัะธะฟัะพะฒ

### ะกัะตะฝะฐัะธะน 2: "ะงัะพ ะผั ะพะฑะตัะฐะปะธ ะบะปะธะตะฝัั?"

ะะพะฟัะพั: *"ะะฐะบะธะต ะดะพะณะพะฒะพััะฝะฝะพััะธ ะตััั ั ะคะค-4405 ะบะพัะพััะต ะตัั ะฝะต ะฒัะฟะพะปะฝะตะฝั?"*

RAG ะฝะฐะนะดัั:
- ะธะท ััะฐะฝัะบัะธะฟัะพะฒ ัะพะทะฒะพะฝะพะฒ: ัะฒะฝัะต ะพะฑะตัะฐะฝะธั ะธ ะดะตะดะปะฐะนะฝั
- ะธะท ัะฐัะฐ: ะฝะตะทะฐะบััััะต ะฒะพะฟัะพัั ะธ ะพะถะธะดะฐะฝะธั ะบะปะธะตะฝัะฐ
- ะธะท summaries: action items ะบะพัะพััะต ะฑัะปะธ ะทะฐัะธะบัะธัะพะฒะฐะฝั

### ะกัะตะฝะฐัะธะน 3: ะะตัะตัะฝะธะน ะดะฐะนะดะถะตัั

ะ 22:00 Workflow 03 ะฐะฒัะพะผะฐัะธัะตัะบะธ:
1. ะะตััั ะฒัะต ัะพะพะฑัะตะฝะธั ัะฐัะฐ ะทะฐ ะดะตะฝั ะธะท `chat_messages`
2. ะะตััั ะฒัะต ััะฐะฝัะบัะธะฟัั ัะพะทะฒะพะฝะพะฒ ะธะท `processed_files`
3. ะะปั ะบะฐะถะดะพะณะพ ะบะปะธะตะฝัะฐ: GLM-4 ะณะตะฝะตัะธััะตั ะบัะฐัะบะพะต summary
4. ะกะพััะฐะฝัะตั ะฒ `client_summaries` + ะฒ ัะฐะนะป `.md`

ะ 23:00 Workflow 02 ะพัะฟัะฐะฒะปัะตั ัะฒะพะดะฝัะน ะดะฐะนะดะถะตัั ะฒ Telegram.

---

## 7. ะะณัะฐะฝะธัะตะฝะธั ัะตะบััะตะน ัะตะฐะปะธะทะฐัะธะธ (Phase 1)

| ะะณัะฐะฝะธัะตะฝะธะต | ะะฟะธัะฐะฝะธะต | ะะพะณะดะฐ ะธัะฟัะฐะฒะธะผ |
|-------------|----------|----------------|
| ะะตั ะฐะฒัะพะผะฐัะธัะตัะบะพะน ะตะถะตะดะฝะตะฒะฝะพะน ะฒัะณััะทะบะธ ัะฐัะพะฒ | ะัะถะฝะพ ะทะฐะฟััะบะฐัั `export_telegram_chat.py` ะฒัััะฝัั ะธะปะธ ะฟะพ ะบัะพะฝั | Phase 2 |
| RAG ะฒ open-notebook ะฝะต ัะธะปััััะตั ะฟะพ ะดะฐัะต | ะะพะธัะบ ะธะดัั ะฟะพ ะฒัะตะน ะธััะพัะธะธ | ะะพะถะฝะพ ะพะฑะพะนัะธ ัะตัะตะท ัะพัะผัะปะธัะพะฒะบั ะฒะพะฟัะพัะฐ |
| ะะดะธะฝ ะฑะปะพะบะฝะพั ะฝะฐ ะบะปะธะตะฝัะฐ = ะฒัะต ะดะฐะฝะฝัะต ะฒะฟะตัะตะผะตัะบั | ะะตั ัะฐะทะดะตะปะตะฝะธั "ะทะฒะพะฝะบะธ" vs "ัะฐั" ะฒะฝัััะธ ะฑะปะพะบะฝะพัะฐ | ะัะธะตะผะปะตะผะพ ะดะปั MVP |
| ะะตั ัะฒะตะดะพะผะปะตะฝะธั ะบะพะณะดะฐ ะบะปะธะตะฝั ะฝะฐะฟะธัะฐะป | ะขะพะปัะบะพ ะตะถะตะดะฝะตะฒะฝะฐั ะฒัะณััะทะบะฐ | Phase 2 (webhook) |
| ะะตั ัะฒัะทะธ ั Bitrix24 | ะะตั ะดะฐะฝะฝัั ะธะท CRM | Phase 3 |

---

## 8. ะััะฐัะพัั โ ะฟัะธะฒัะทะบะฐ ะบ ะดะพะณะพะฒะพัะฐะผ

### ะัะฐะฒะธะปะฐ

- ะฃ ะบะฐะถะดะพะณะพ ะดะพะณะพะฒะพัะฐ ะตััั **ะพะดะธะฝ ะธะปะธ ะดะฒะฐ ะบััะฐัะพัะฐ**
- ะััะฟะฝัะต ะบะปะธะตะฝัั ะผะพะณัั ะธะผะตัั ะดะฒัั ะบััะฐัะพัะพะฒ
- ะััะฐัะพั ััะฐะฝะธััั ะฒ ัะฐะฑะปะธัะต `lead_chat_mapping` ะฒ ะฟะพะปะต `curators`

### ะะทะผะตะฝะตะฝะธะต ััะตะผั ัะฐะฑะปะธัั (ะทะฐะฟะปะฐะฝะธัะพะฒะฐะฝะพ ะฝะฐ 2026-02-21)

```sql
ALTER TABLE lead_chat_mapping
ADD COLUMN curators VARCHAR(255);
-- ะคะพัะผะฐั: ะพะดะฝะพ ะธะผั ะธะปะธ ะดะฒะฐ ัะตัะตะท ะทะฐะฟัััั
-- ะัะธะผะตัั: 'ะะฒะณะตะฝะธะน', 'ะะฒะณะตะฝะธะน, ะัะธััะธะฝะฐ'
```

### ะะฐะบ ะฑัะดะตั ะฒัะณะปัะดะตัั ะดะฐะนะดะถะตัั ะฒ Telegram

ะกะพะพะฑัะตะฝะธั ะณััะฟะฟะธัััััั **ะฟะพ ะบััะฐัะพัั**, ะฝะต ะฟะพ ะบะปะธะตะฝัั:

```
๐ ะัััั ะคะค ะะปะฐััะพัะผั โ 20.02.2026

๐ค ะะฒะณะตะฝะธะน
  ะคะค-4405 โ 2 ัะพะทะฒะพะฝะฐ, 3 โ / 2 โ โ [ะฟะพะดัะพะฑะฝะพ]
  ะคะค-987  โ 0 ัะพะทะฒะพะฝะพะฒ, 5 โ / 1 โ โ [ะฟะพะดัะพะฑะฝะพ]

๐ค ะัะธััะธะฝะฐ
  ะคะค-1381 โ 1 ัะพะทะฒะพะฝ, 4 โ / 0 โ โ [ะฟะพะดัะพะฑะฝะพ]
  ะคะค-506  โ ััะตะทะถะฐะตั โ๏ธ โ [ะฟะพะดัะพะฑะฝะพ]

๐ค ะะฒะณะตะฝะธะน + ะัะธััะธะฝะฐ
  ะคะค-2048 โ 0 ัะพะทะฒะพะฝะพะฒ, 2 โ / 0 โ โ [ะฟะพะดัะพะฑะฝะพ]
```

ะัะปะธ ั ะบะปะธะตะฝัะฐ ะดะฒะฐ ะบััะฐัะพัะฐ โ ะพะฝ ะฟะพัะฒะปัะตััั ะฒ ะพัะดะตะปัะฝะพะน ัะตะบัะธะธ ั ะพะฑะพะธะผะธ ะธะผะตะฝะฐะผะธ.

---

## 9. ะคะพัะผะฐั Telegram-ะดะฐะนะดะถะตััะฐ (ะดะตัะฐะปัะฝะฐั ัะฟะตัะธัะธะบะฐัะธั)

### ะัะธะฝัะธะฟ: ะบัะฐัะบะพ ะฒ Telegram, ะฟะพะดัะพะฑะฝะพ ะฒ open-notebook

| ะะดะต | ะงัะพ ัะพะดะตัะถะธั |
|-----|-------------|
| **Telegram** | ะกะฟะธัะพะบ ะบะปะธะตะฝัะพะฒ ะฟะพ ะบััะฐัะพัะฐะผ. ะะปั ะบะฐะถะดะพะณะพ: N ัะพะทะฒะพะฝะพะฒ, N ัะตััะฝะฝัั, N ะฝะตัะตััะฝะฝัั ะฒะพะฟัะพัะพะฒ. ะกััะปะบะฐ ะฝะฐ ะฟะพะดัะพะฑะฝะพะต summary. |
| **ะะพะดัะพะฑะฝะพะต summary** (.md ัะฐะนะป) | ะะพะปะฝัะน ะฐะฝะฐะปะธะท: ััะฐััะฝะธะบะธ, ะดะพะณะพะฒะพััะฝะฝะพััะธ, action items, ัะพะฝ ะบะปะธะตะฝัะฐ, ัะธัะฐัั. |
| **open-notebook** (ะฟะตััะฟะตะบัะธะฒะฐ) | RAG-ัะฐั ะฟะพ ะฒัะตะน ะธััะพัะธะธ ะบะปะธะตะฝัะฐ. |

### ะัะบัะดะฐ ะฑะตััััั ะบะฐะถะดะฐั ัะธััะฐ

| ะะพะปะต ะฒ ะดะฐะนะดะถะตััะต | ะััะพัะฝะธะบ | ะะฐะบ ััะธัะฐะตััั |
|------------------|----------|---------------|
| ะะพะป-ะฒะพ ัะพะทะฒะพะฝะพะฒ | `processed_files` | COUNT WHERE lead_id + DATE = ัะตะณะพะดะฝั |
| ะะตััะฝะฝัะต ะฒะพะฟัะพัั โ | GLM-4 ะฐะฝะฐะปะธะท ัะฐัะฐ | JSON-ะพัะฒะตั: `resolved_count` |
| ะะตัะตััะฝะฝัะต ะฒะพะฟัะพัั โ | GLM-4 ะฐะฝะฐะปะธะท ัะฐัะฐ | JSON-ะพัะฒะตั: `open_count` |
| ะััะฐัะพั | `lead_chat_mapping.curators` | ะััะฟะฟะธัะพะฒะบะฐ ะฟะพ ะธะผะตะฝะธ |
| ะกััะปะบะฐ [ะฟะพะดัะพะฑะฝะพ] | nginx ัะฐะนะปะพะฒัะน ัะตัะฒะตั | `http://84.252.100.93:8080/summaries/ะะะขะ/LEAD-XXXX.md` |

### ะะพะฒัะน ะฟัะพะผะฟั ะดะปั GLM-4 (ัะฐั โ ััััะบัััะธัะพะฒะฐะฝะฝัะน JSON)

GLM-4 ะดะพะปะถะตะฝ ะฒะพะทะฒัะฐัะฐัั **ะดะฒะฐ ะฑะปะพะบะฐ**:
1. **JSON-ัััะพะบั** ั ัะธััะฐะผะธ ะดะปั ะดะฐะนะดะถะตััะฐ
2. **Markdown-ัะตะบัั** ั ะฟะพะดัะพะฑะฝัะผ ะฐะฝะฐะปะธะทะพะผ ะดะปั `.md` ัะฐะนะปะฐ

```
ะะซะฅะะะะะ ะคะะะะะข:

STATS_JSON:
{
  "resolved_count": 3,
  "open_count": 2,
  "calls_count": 0,
  "client_mood": "ะฝะตะณะฐัะธะฒะฝัะน",
  "alert": "ััะตะทะถะฐะตั"   โ ะธะปะธ null
}

SUMMARY_MD:
## ะะตัะธะพะด ะพะฑัะตะฝะธั
...ะฟะพะปะฝัะน markdown...
```

### ะกััะปะบะธ ะฒ Telegram (ะะฐัะธะฐะฝั ะ โ nginx)

ะะพะบะฐ: nginx ัะฐะทะดะฐัั `.md` ัะฐะนะปั ะบะฐะบ ััะฐัะธะบั.

```
http://84.252.100.93:8080/summaries/2026-02-20/LEAD-4405_chat_2026-02-20.md
```

ะ Telegram ััะพ ะฒัะณะปัะดะธั ะบะฐะบ ะบะปะธะบะฐะฑะตะปัะฝะฐั ัััะปะบะฐ. ะคะฐะนะป ะพัะบััะฒะฐะตััั ะฒ ะฑัะฐัะทะตัะต ะบะฐะบ ัะตะบัั.

ะะฐ ะฟะตััะฟะตะบัะธะฒั (ะะฐัะธะฐะฝั ะ): ัััะปะบะธ ะฒะตะดัั ะฟััะผะพ ะฒ open-notebook:
```
http://84.252.100.93:8888/notebooks/LEAD-4405
```

---

## 10. ะะฐะบ ะดะพะฑะฐะฒะธัั ะฝะพะฒะพะณะพ ะบะปะธะตะฝัะฐ ะฒ ัะธััะตะผั (ัะตะบะปะธัั)

```
[ ] 1. ะฃะทะฝะฐัั ะฝะพะผะตั ะดะพะณะพะฒะพัะฐ (lead_id) โ ะฝะฐะฟัะธะผะตั 5001
[ ] 2. ะฃะทะฝะฐัั ะบััะฐัะพัะฐ (ะธะปะธ ะดะฒัั) โ ะฝะฐะฟัะธะผะตั "ะะฒะณะตะฝะธะน" ะธะปะธ "ะะฒะณะตะฝะธะน, ะัะธััะธะฝะฐ"
[ ] 3. ะะฐะนัะธ Telegram ัะฐั:
        python3 list_telegram_chats.py --session session_evgenii
        โ ะทะฐะฟะธัะฐัั chat_id ะธะท ัะฟะธัะบะฐ
[ ] 4. ะะพะฑะฐะฒะธัั ะฒ lead_chat_mapping (ั ะบััะฐัะพัะพะผ):
        INSERT INTO lead_chat_mapping
          (lead_id, lead_name, chat_id, chat_title, chat_type, curators)
        VALUES ('5001', 'ะคะค-5001', CHAT_ID, 'ะะฐะทะฒะฐะฝะธะต ัะฐัะฐ', 'group', 'ะะฒะณะตะฝะธะน');
[ ] 5. ะัะณััะทะธัั ะธััะพัะธั ัะฐัะฐ:
        python3 export_telegram_chat.py --session session_evgenii --chat CHAT_ID --lead-id 5001
[ ] 6. ะะฐะณััะทะธัั ะฒ ะฑะฐะทั:
        python3 import_chat_to_db.py --lead-id 5001 --file LEAD-5001_chat.json ...
[ ] 7. ะกะณะตะฝะตัะธัะพะฒะฐัั ะฝะฐัะฐะปัะฝะพะต summary (ะฟะพ ะฒัะตะน ะธััะพัะธะธ):
        python3 generate_individual_summary.py --lead-id 5001 --source chat --all-history ...
[ ] 8. ะฃะฑะตะดะธัััั ััะพ ะฑะปะพะบะฝะพั ะฟะพัะฒะธะปัั ะฒ open-notebook:
        http://84.252.100.93:8888 โ ะดะพะปะถะตะฝ ะฑััั LEAD-5001
```

---

*ะะพะบัะผะตะฝั ัะพะทะดะฐะฝ: 2026-02-20 | ะะฑะฝะพะฒะปัะฝ: 2026-02-20 โ ะดะพะฑะฐะฒะปะตะฝั ัะฐะทะดะตะปั 8-10: ะบััะฐัะพัั, ัะพัะผะฐั ะดะฐะนะดะถะตััะฐ, nginx*
